# خطة تطوير الدراور (القائمة الجانبية) وتحسين شكل التطبيق

وثيقة موحّدة لـ:
1. الباقي من خطة التنفيذ (Pulse، إشعارات FCM)
2. تطوير الدراور بشكل كامل — خيارات مباشرة دون انتقال لشاشة الإعدادات
3. تحسين واجهة الصفحة الرئيسية وصفحة العائلة

---

## الجزء 1 — الباقي من خطة التنفيذ

### 1.1 ما يُنفَّذ بدون Backend
- [x] **3.1 تحسين عرض النبض**: وقت نسبي (موجود)، أيقونات مميزة (صلاة، تشجيع، إكمال يوم، احتفال)، ألوان حسب النوع (أخضر/أزرق/أساسي/كهرماني) + حدود جانبية وخلفية خفيفة. القسم معروض بين ملخص العائلة وقائمة الأعضاء.

### 1.2 ما يعتمد FCM/Backend (توثيق أو تجهيز)
- [ ] **3.2 إشعار عائلي "فلان صلّى X"**: توثيق متطلبات FCM + Cloud Function أو Listener؛ إعداد بنية الـ payload إن وُجد FCM.
- [ ] **3.3 إشعار تشجيع للمُشجَّع**: نفس التوثيق أو إشعار محلي تجريبي عند الضغط على "شجّعه".

### 1.3 اختياري لاحقاً
- [ ] **5.2** فصل ويدجتات كبيرة من `dashboard_screen.dart` و `family_dashboard_screen.dart` إلى ملفات منفصلة.

---

## الجزء 2 — تطوير الدراور (القائمة الجانبية) بشكل كامل

### الهدف
**عند الضغط على "الصوت" أو "المظهر" أو "اللغة" تظهر الخيارات مباشرة داخل الدراور دون الانتقال لشاشة الإعدادات.** تجربة أسرع وأوضح.

### 2.1 هيكل الدراور الجديد

```
┌─────────────────────────────────┐
│  [صورة] الاسم / البريد          │  ← الهيدر (ضغط → الملف الشخصي)
├─────────────────────────────────┤
│  تخصيص                          │
│  ├ اللغة          [عربي ▾]      │  ← قابلة للتوسيع: عند الضغط تظهر (عربي / English)
│  ├ المظهر         [داكن ▾]      │  ← قابلة للتوسيع: فاتح / داكن / تلقائي
│  └ الصوت          [أذان ▾]      │  ← قابلة للتوسيع: أذان / هزاز / صامت
├─────────────────────────────────┤
│  الإعدادات                      │
│  └ إعدادات التطبيق    >         │  ← يفتح شاشة الإعدادات الكاملة (موقع، إشعارات، حساب، إلخ)
├─────────────────────────────────┤
│  التكامل                        │
│  ├ تقويم جوجل                   │
│  └ وسائل التواصل                │
├─────────────────────────────────┤
│  الدعم والملاحظات               │
│  ├ تواصل / اقتراح / تقرير خطأ   │
├─────────────────────────────────┤
│  [تسجيل الخروج]                 │
└─────────────────────────────────┘
```

### 2.2 بنود قابلة للتوسيع (Expansion داخل الدراور)

| البند | عند الضغط | الخيارات المعروضة مباشرة |
|-------|-----------|---------------------------|
| **اللغة** | توسيع الصف | عربي | English (أو قائمة راديو) |
| **المظهر** | توسيع الصف | فاتح | داكن | تلقائي |
| **الصوت** | توسيع الصف | أذان | هزاز | صامت |

- لا انتقال لشاشة أخرى؛ الخيارات تظهر تحت الصف (انسيابية أو قائمة صغيرة).
- بعد اختيار قيمة يُغلق القسم المفتوح ويُحدَّث النص الجانبي (مثلاً "الصوت: أذان").

### 2.3 تنفيذ تقني مقترح

- استخدام **ExpansionTile** أو **InkWell** + **AnimatedCrossFade** لقسم "تخصيص" مع صفوف قابلة للتوسيع.
- ربط كل خيار بـ **SettingsController** (مثل `setNotificationSoundMode`, `changeTheme`, `LocalizationService`).
- زر **"إعدادات التطبيق"** يبقى للانتقال إلى شاشة الإعدادات الكاملة (الموقع، طريقة الحساب، الإشعارات التفصيلية، الملف الشخصي، إلخ).

### 2.4 تحسينات إضافية للدراور

- [x] أيقونة واضحة لكل قسم (لغة، مظهر، صوت) مع عرض القيمة الحالية في الـ subtitle.
- [x] سهم التوسيع للبنود القابلة للتوسيع؛ صف "إعدادات التطبيق" فقط يفتح شاشة الإعدادات الكاملة (مع subtitle توضيحي).
- [x] الخيارات تظهر مباشرة تحت كل بند (ExpansionTile) دون انتقال لشاشة أخرى.

---

## الجزء 3 — تحسين شكل التطبيق (الرئيسية والعائلة)

### 3.1 الصفحة الرئيسية (Dashboard)

| المنطقة | التحسين المقترح |
|---------|------------------|
| **الهيدر (AppBar)** | خط أحمر خفيف تحت الـ AppBar عند استخدام الموقع الافتراضي؛ اسم المدينة + أيقونة واضحة. |
| **الساعة** | حجم وتنسيق مريح (موجود). |
| **بانر الموقع الافتراضي** | حدود، ظل خفيف، AppDimensions.radiusLG و iconMD. |
| **دائرة الصلاة (SmartPrayerCircle)** | ألوان متسقة (موجود). |
| **التقدم اليومي** | بطاقة بخلفية surface، radiusLG، ظل خفيف، شريط تقدم بـ radiusSM. |
| **الشريط السفلي (NavigationBar)** | لون الخلفية والمؤشر متناسقان مع الثيم؛ أيقونات الرئيسية والعائلة واضحة. |
| **الصلوات السريعة (Timeline)** | تباعد وقراءة أفضل؛ أيقونة أو لون للصلاة الحالية. |
| **مؤشر الاتصال** | مكان ثابت (تحت البانر أو فوق القائمة) دون إزعاج المحتوى. |

### 3.2 صفحة العائلة

| المنطقة | التحسين المقترح |
|---------|------------------|
| **هيدر العائلة** | اسم العائلة + مبدّل العائلات؛ زر الإشعارات مع نقطة "غير مقروء" إن وُجد. |
| **الفايتالي أورب / الشعلة** | أحجام وتنسيق متناسق؛ ألوان من الثيم. |
| **نبض العائلة** | منفّذ: وقت نسبي، أيقونات، ألوان، حدود جانبية؛ Card بـ radiusLG و shadowColor. |
| **قائمة الأعضاء** | بطاقات بـ radiusLG (موجود). |
| **الألوان والتباعد** | AppColors و AppDimensions في النبض وملخص العائلة وبطاقة التقدم. |

### 3.3 تناسق عام

- [x] استخدام **AppDimensions** (radiusLG, paddingLG, iconMD, borderRadiusSM) في البانر، بطاقة التقدم، وبطاقات العائلة.
- [x] قواعد بسيطة: بطاقة التقدم والبانر بحدود وظل خفيف؛ بطاقات النبض والملخص والعائلة بـ radiusLG و shadowColor موحّد.
- [ ] مراجعة شاملة لباقي الشاشات (اختياري).

---

## أولوية التنفيذ المقترحة

1. **الدراور**: توسيع الصوت والمظهر واللغة داخل الدراور (بدون انتقال للإعدادات) + إعادة تنظيم البنود.
2. **تحسين النبض**: وقت نسبي وأيقونات وألوان (3.1).
3. **تحسينات بصرية للرئيسية والعائلة**: حسب الجدولين أعلاه، خطوة بخطوة.
4. **توثيق FCM** للبنود 3.2 و 3.3 عند الجاهزية.

---

**مرجع:** [EXECUTION_PLAN.md](EXECUTION_PLAN.md) — [MASTER_SPEC_NOTIFICATIONS_AND_ENGAGEMENT.md](MASTER_SPEC_NOTIFICATIONS_AND_ENGAGEMENT.md) — [ARCHITECTURE.md](ARCHITECTURE.md)
