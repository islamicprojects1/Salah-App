# خطة إكمال التطبيق والإطلاق على Google Play

مرجعية: **rules.txt** + **specification.txt** (قُرب — عائلة تتابع صلاتها معاً)

---

## المرحلة 0: الوضع الحالي (ما تم)

| من الـ MVP | الحالة |
|------------|--------|
| Auth (تسجيل/دخول/ملف) | ✅ |
| Prayer times + countdown | ✅ |
| Log prayer (من التطبيق/إشعار) | ✅ |
| Qibla | ✅ |
| Create family | ✅ |
| Invite (كود) | ✅ |
| Join family | ✅ |
| Add child without phone | ✅ |
| Parent logs for child | ✅ واجهة "سجّل عنه" في شاشة العائلة (للمدير فقط، للأطفال) |
| See family status | ✅ |
| Encourage/Remind | ✅ (تشجيع) |
| Streak | ✅ |
| Offline + sync | ✅ |
| الإعدادات (لغة، ثيم، إشعارات، موقع) | ✅ |
| Firestore rules | ✅ |

---

## المرحلة 1: استكمال الـ MVP حسب المواصفات والقواعد

### 1.1 القواعد (rules.txt)

| القاعدة | المطلوب |
|---------|---------|
| كل كلمة في values (عربي + إنجليزي) | مراجعة كل الشاشات: استبدال أي نص ثابت بـ `'key'.tr` وإضافة المفتاح في `ar_translations.dart` و `en_translations.dart`. |
| تقسيم ملفات مرتب | الهيكل الحالي (core/data/controller/view) مناسب؛ التأكد من عدم وجود شاشات/ملفات مكررة أو خارج المكان. |
| كل بكج: manifest + gradle إلخ | مراجعة `android/app/build.gradle`, `AndroidManifest.xml`, `ios/` لأي صلاحيات أو إعدادات ناقصة (إشعارات، موقع، إنترنت). |
| استخدام constants والـ assets | التأكد أن الأيقونات والأنيميشن في `assets/` مستخدمة من `ImageAssets` و `AppDimensions` وثيم الألوان من `AppColors`. |
| سيناريوهات (أوفلاين، بدون نت عند التسجيل…) | التأكد: تسجيل صلاة بدون نت → يحفظ محلياً ثم مزامنة؛ رفض الموقع → رسالة واضحة وتحديث من الإعدادات. |

**مهام محددة:**
- [ ] تدقيق نصوص الواجهة: استخراج كل العبارات الثابتة إلى مفاتيح ترجمة (AR/EN).
- [ ] مراجعة `AndroidManifest.xml` و `build.gradle` و `Info.plist` للصلاحيات والإصدارات.
- [ ] التأكد أن كل الشاشات تستخدم `AppColors`, `AppFonts`, `AppDimensions` وليس قيمًا مكتوبة يدويًا.

### 1.2 من المواصفة (specification.txt)

| البند | المطلوب |
|-------|---------|
| Parent logs for child | إذا لم تكن واجهة "سجّل صلاة عنه" موجودة: إضافة زر على بطاقة العضو (الطفل) في شاشة العائلة: "سجّل عنه" يفتح اختيار الصلاة ثم استدعاء `FamilyService.logPrayerForMember`. |
| Notifications: أذان، +30، عائلة صلّت | التحقق: إشعار الأذان، إشعار "هل صليت؟" بعد 30 دقيقة، وإشعار "X صلّى" عند تسجيل عضو عائلة (إن وُجد). ربط كلها بإعداد "إشعارات الصلاة" في الإعدادات. |
| Joining: Link / QR | حالياً الكود موجود؛ إضافة مشاركة رابط دعوة (مثل `https://yourapp.page.link/invite?code=XXX`) أو QR يعرض الكود يكمّل المواصفة. |
| Family streak: الكل صلّى | إن لم يكن معروضاً: عرض "ستريك العائلة" (مثلاً يوم واحد عندما يكون كل الأعضاء قد سجّلوا 5/5 في نفس اليوم). |

**مهام محددة:**
- [x] واجهة "سجّل صلاة عنه" للأطفال في شاشة العائلة (استخدام `logPrayerForMember`).
- [ ] التحقق من جدولة الإشعارات (أذان، +30) — مرتبطة بإعداد "إشعارات الصلاة"؛ إشعار "X صلّى" للمرحلة 2 إن رغبت.
- [ ] مشاركة الدعوة: رابط أو QR بالإضافة إلى الكود النصي.
- [ ] (اختياري) عرض "ستريك العائلة" في شاشة العائلة أو الداشبورد.

---

## المرحلة 2: الاستقرار وجودة التجربة

- [ ] **معالجة الأخطاء:** رسائل خطأ واضحة بالعربية عند فشل الشبكة، رفض الصلاحيات، أو فشل تسجيل الدخول.
- [ ] **Splash وفتح التطبيق:** عدم شاشة بيضاء؛ الانتظار حتى جاهزية Auth ثم التوجيه (onboarding / login / dashboard).
- [ ] **Offline:** التأكد أن تسجيل الصلاة والعائلة يظهر بشكل صحيح عند العودة للاتصال (مزامنة وعدم فقدان بيانات).
- [ ] **اختبار على أجهزة متعددة:** حجم شاشة، RTL، وضع داكن.

---

## المرحلة 3: الاستعداد لمتجر Google Play

### 3.1 متطلبات Google

- [ ] **سياسة الخصوصية (Privacy Policy):** صفحة ويب متاحة للجميع تشرح: البيانات المجمعة (حساب، بريد، موقع، سجل صلاة)، الغرض، من يتلقاها (Firebase)، وكيفية حذف الحساب. إضافة رابط في التطبيق (الإعدادات) وفي صفحة المتجر.
- [ ] **Data safety (في Play Console):** الإعلان عن جمع الموقع، المعرفات، وسجل الصلاة حسب النموذج.
- [ ] **حساب المطور:** حساب Google Play Developer مدفوع.
- [ ] **توقيع التطبيق (App signing):** استخدام Google Play App Signing؛ الاحتفاظ بـ upload key بشكل آمن.

### 3.2 أصول المتجر

- [ ] **أيقونة التطبيق:** 512×512 للمتجر (من `assets/icons/app_icon.png` أو تصدير من التصميم).
- [ ] **لقطات شاشة (Screenshots):** على الأقل 2–4 للهاتف (مثلاً: الداشبورد، العائلة، القبلة، الإعدادات).
- [ ] **وصف قصير وطويل:** بالعربية (وإن أمكن الإنجليزية) — مواقيت، تسجيل صلاة، قبلة، عائلة ومتابعة معاً.
- [ ] **الفئة والعمر:** اختيار فئة مناسبة (مثل Lifestyle) وتحديد الفئة العمرية (مثلاً 3+ إذا لا يوجد محتوى حساس).

### 3.3 داخل التطبيق

- [ ] **رابط سياسة الخصوصية** في الإعدادات (عن التطبيق أو قسم قانوني).
- [ ] **رقم إصدار ثابت:** من `pubspec.yaml` أو من ثابت يُعرض في "عن التطبيق".

---

## المرحلة 4: الإطلاق والمتابعة

- [ ] رفع أول بناء (AAB) إلى Play Console (Internal testing ثم Closed/Open testing حسب الحاجة).
- [ ] مراجعة تقارير Pre-launch إن وُجدت وإصلاح الأعطال الحرجة.
- [ ] الإطلاق للإنتاج (Production).
- [ ] متابعة التقييمات والمراجعات والرد بأدب مع توضيح كيفية استخدام الميزات (موقع، إشعارات، عائلة).

---

## ملخص ترتيب التنفيذ المقترح

1. **المرحلة 1.1** — تطبيق القواعد (نصوص، constants، assets، manifest/gradle).
2. **المرحلة 1.2** — استكمال MVP (سجّل عنه، إشعارات، رابط/QR دعوة، ستريك العائلة إن لزم).
3. **المرحلة 2** — استقرار ورسائل خطأ وتجربة أوفلاين.
4. **المرحلة 3** — سياسة خصوصية، Data safety، أصول المتجر، وروابط داخل التطبيق.
5. **المرحلة 4** — رفع واختبار وإطلاق.

بهذا تكون الخطة **كاملة ومتكاملة** من إكمال الميزات حسب المواصفة والقواعد حتى الإطلاق على Google Play. يمكن تقسيم المهام إلى commits صغيرة كما في rules (كل إضافة صغيرة = كوميت).
