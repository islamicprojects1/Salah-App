# مواصفة وفلسفة الربط الاجتماعي — العائلة والمجموعات

> وثيقة تفكير وتصميم شاملة — كيف نربط الناس في التطبيق بدون خلل؟

---

## 1. فلسفة الربط في عالم اليوم

### ماذا يريده المستخدم؟

- **الربط:** الشعور بأنه جزء من مجموعة تصلي معاً.
- **الخصوصية:** لا يريد أحد أن يرى صلواته الفردية تفصيلياً.
- **النظرة الشاملة:** يريد أن يعرف "كم من العائلة صلّى اليوم" دون تفاصيل مَن صلّى ماذا.
- **التشجيع:** أن يعرف أن هناك من يحفّزه — دون إزعاج (إشعارات لاحقاً).

### المواصفات الحاكمة

| المبدأ | التفسير |
|--------|---------|
| **الخصوصية أولاً** | لا يعرض التطبيق صلوات فرد X لشخص Y — إلا بموافقة X صريحة (لاحقاً). |
| **النظرة الشاملة فقط** | "٤/٥ من العائلة صلّوا الفجر اليوم" — بدون أسماء أو تفاصيل. |
| **إشعارات بين الأعضاء** | مؤجّلة — لاحقاً نضيفها بإعدادات دقيقة. |
| **مرونة في الأدوار** | يدعم: أب+أبناء، شيخ+طلاب، أصدقاء — بنفس النموذج. |

---

## 2. أين تظهر صفحة العائلة/المجموعة؟

### أسلوب التطبيق الحالي

- **لا يوجد Bottom Navigation** — الشاشة الرئيسية واحدة (Dashboard).
- **الوصول عبر Drawer** — إعدادات، إحصائيات، وغيرها.

### التوصية: Drawer

| الخيار | المزايا | العيوب |
|--------|---------|--------|
| **Drawer** | يطابق بقية التطبيق، لا يغيّر الهيكل، مكان واضح (قسم Integration/Social) | ربما أقل ظهوراً من Bottom Nav |
| **Bottom Nav** | ظهور دائم | يحتاج إعادة هيكلة كبيرة، التطبيق حالياً بسيط |

**القرار:** إضافة بند **"العائلة" / "My Family"** في Drawer (قسم Integration أو قسم مستقل) يفتح شاشة العائلة/المجموعة. هذا أسلوب التطبيق ولا يقتضي تغييراً جذرياً.

---

## 3. كيف نربط الناس؟ (الآلية التقنية)

### 3.1 Invite Code (الكود)

- المدير ينشئ مجموعة → يولد التطبيق **كوداً قصيراً** (مثلاً 6–8 أحرف: `QRB7K2`).
- الأعضاء يدخلون الكود يدوياً أو يمسحون QR.
- **المزايا:** بسيط، يعمل بدون إنترنت لحظة الدخول، مناسب لمن لا يملكون بريداً.
- **العيوب:** يجب مشاركة الكود يدوياً (رسالة، ورقة، إلخ).

### 3.2 Invite Link (رابط الدعوة)

- رابط عميق: `qurb.app/join/QRB7K2` أو `https://play.google.com/...?invite=QRB7K2`
- عند فتح الرابط → يفتح التطبيق ويضيف المستخدم للمجموعة.
- **المزايا:** سهولة المشاركة (واتساب، رسالة، إلخ).
- **العيوب:** يحتاج تثبيت التطبيق مسبقاً أو توجيه لمتجر التطبيق.

### 3.3 QR Code

- المدير يعرض QR في الشاشة → العضو يمسحه بكاميرا التطبيق.
- **المزايا:** سريع في الاجتماعات الحضورية (شيخ+طلاب، أسرة واحدة).
- **العيوب:** يحتاج لقاءً فعلياً أو صورة QR مُشارَكة.

### التوصية

- **الكود + الرابط معاً:** الكود للدخول اليدوي، الرابط للمشاركة.
- **QR اختياري:** يُولَّد من نفس الكود؛ عند المسح يفتح التطبيق مع الكود مضمناً.

---

## 4. الأدوار والهيكل

### 4.1 المدير (Admin) vs العضو (Member)

| الدور | الصلاحيات |
|-------|-----------|
| **Admin** | إنشاء المجموعة، إنشاء الكود، دعوة الأعضاء، إضافة أعضاء "ظِل" (بدون هاتف)، حذف مجموعة، مغادرة (مع نقل الإدارة لشخص آخر إن وُجد). |
| **Member** | رؤية الملخص الشامل، طلب انضمام عبر الكود، مغادرة المجموعة. |

### 4.2 أنواع الأعضاء

| النوع | يملك هاتفاً؟ | كيف يُضاف؟ | ماذا يرى؟ |
|-------|--------------|------------|-----------|
| **عضو فعلي** | نعم | ينضم بالكود/الرابط/QR بنفسه | الملخص الشامل + إحصائياته الشخصية |
| **عضو ظِل (Shadow)** | لا | المدير يضيفه يدوياً (اسم فقط) | لا يرى شيئاً (لا يملك التطبيق) |

---

## 5. السيناريوهات المختلفة — كيف نستوعبها؟

### 5.1 أب + أبناء (مع هاتف)

- الأب ينشئ مجموعة (Admin).
- الأبناء يثبتون التطبيق ويدخلون الكود.
- النتيجة: مجموعة عائلية، الملخص الشامل يظهر للجميع.

### 5.2 أب + أبناء (بعضهم بدون هاتف)

- الأب يضيف الأبناء بلا هاتف كـ **أعضاء ظِل** (اسم + اختياري: صفة مثل "الابن الأكبر").
- في الملخص: "٥/٧ من العائلة صلّوا اليوم" — ٧ = فعليون + ظِل.
- الأعضاء الظِل لا يسجّلون صلواتاً من التطبيق؛ الأب (أو أم) يمكنه تسجيل نيابة عنهم من واجهة "تسجيل للآخرين" (ميزة مستقبلية).

### 5.3 شيخ + طلاب

- الشيخ ينشئ مجموعة (Admin) — يمكن تسميتها "مجموعة الشيخ X" أو "حلقة القرآن".
- الطلاب ينضمون بالكود/الرابط/QR.
- نفس النموذج: مدير + أعضاء. لا فرق تقنياً عن العائلة؛ الفرق في التسمية وسياق الاستخدام.

### 5.4 أصدقاء

- أحد الأصدقاء ينشئ مجموعة (Admin).
- الباقون ينضمون بالكود.
- يمكن تسمية المجموعة "أصدقاء المسجد" أو "مجموعة الرفاق" — نفس الهيكل.

### 5.5 خلاصة النموذج الموحّد

```
مجموعة (Group)
├── نوع: عائلة | مجموعة قيادة (شيخ+طلاب) | أصدقاء
├── مدير (Admin) — واحد
├── أعضاء فعليون (يملكون التطبيق)
└── أعضاء ظِل (لا يملكون التطبيق — يُضافون يدوياً بالاسم)
```

**الفلسفة:** نموذج واحد مرن، التسمية والسياق يحدده المستخدم.

---

## 6. ما الذي يُعرَض؟ (الخصوصية)

### 6.1 ما لا يُعرَض أبداً (بدون موافقة صريحة)

- صلوات فرد X مفصّلة (مَن صلّى ماذا ومتى) لأي شخص آخر.
- سجل الصلوات الفائتة لفرد معين.
- تفاصيل الإحصائيات الشخصية (heatmap، streaks) إلا لصاحبها.

### 6.2 ما يُعرَض للمجموعة

| العنصر | الوصف |
|--------|-------|
| **ملخص اليوم** | "X/Y من المجموعة صلّوا اليوم" (بدون أسماء من صلّى ومن لم يصلّ) |
| **شعلة المجموعة** | مؤشر جامع (نسبة الإكمال) — لون/رمز يعبّر عن نشاط المجموعة |
| **عدد الأعضاء** | كم شخص في المجموعة |
| **انضمام جديد** | "انضم [الاسم] للمجموعة" (اختياري، بإعدادات لاحقة) |

### 6.3 ما يُعرَض للفرد عن نفسه

- صلواته، إحصائياته، ستريكه، كل شيء كما هو الآن.

---

## 7. الإشعارات بين الأعضاء

**المرحلة الحالية:** لا إشعارات بين الأعضاء (كما طلبت).

**للمستقبل:**
- إعداد "إشعارات المجموعة" (تشجيع، احتفال، تذكير لطيف).
- يجب أن تكون قابلة للإيقاف من الإعدادات.
- الابن بدون هاتف: التشجيع يُخزَّن؛ لو افتتح التطبيق لاحقاً يمكن عرضه في "الإشعارات" أو "النشاط".

---

## 8. التدفقات الرئيسية (User Flows)

### 8.1 إنشاء مجموعة

1. المستخدم يفتح "العائلة" من Drawer.
2. يضغط "إنشاء مجموعة" (أو "إنشاء عائلة").
3. يختار نوع المجموعة: عائلة | مجموعة قيادة | أصدقاء.
4. يسمّي المجموعة (اختياري).
5. التطبيق يولد كوداً وعرض QR ورابط مشاركة.
6. يشارك الكود/الرابط/QR مع الآخرين.

### 8.2 الانضمام لمجموعة

1. المستخدم يفتح "العائلة" من Drawer.
2. يضغط "الانضمام بمجموعة".
3. يدخل الكود يدوياً **أو** يمسح QR **أو** يفتح رابط الدعوة (Deep Link).
4. يرى اسم المجموعة ويؤكد الانضمام.
5. يصبح عضواً ويرى الملخص الشامل.

### 8.3 إضافة عضو ظِل (بدون هاتف)

1. المدير يفتح شاشة المجموعة.
2. يضغط "إضافة عضو بدون هاتف".
3. يدخل الاسم (مثلاً "أحمد"، "الابن الأصغر").
4. العضو الظِل يظهر في العدد الكلي للمجموعة وفي الملخص (X/Y).
5. المدير يمكنه لاحقاً تسجيل صلوات نيابة عنه (ميزة مستقبلية) أو يبقى الظِل للعدد فقط.

### 8.4 مغادرة المجموعة

- العضو يضغط "مغادرة المجموعة" → يؤكد → يُزال من المجموعة.
- المدير إن غادر: يختار عضواً آخر كمدير جديد، أو تُحل المجموعة.

---

## 9. هيكل البيانات المقترح (Firestore)

```
groups/{groupId}
├── name: string
├── type: 'family' | 'guided' | 'friends'
├── inviteCode: string (6–8 chars)
├── createdAt: timestamp
├── createdBy: userId
└── members (subcollection)
    └── {userId}
        ├── role: 'admin' | 'member'
        ├── joinedAt: timestamp
        ├── displayName: string
        └── isShadow: boolean (عضو ظِل)

shadow_members (أو كمجال في groups)
├── id: string (shadow_xxx)
├── name: string
├── addedBy: userId
└── addedAt: timestamp
```

---

## 10. خارطة الطريق المقترحة

| المرحلة | المحتوى | التعقيد |
|---------|---------|---------|
| **Phase 1** | إنشاء مجموعة، كود، انضمام، ملخص "X/Y صلّوا اليوم"، أعضاء ظِل | متوسط |
| **Phase 2** | رابط دعوة Deep Link، QR Code | منخفض |
| **Phase 3** | تسجيل صلوات نيابة عن الظِل (للمدير) | متوسط |
| **Phase 4** | إشعارات اختيارية (تشجيع، احتفال) | عالي |

---

## 11. ملخص القرارات

| السؤال | القرار |
|--------|--------|
| أين تظهر العائلة؟ | Drawer — بند "العائلة" أو "مجموعتي" |
| كيف نربط؟ | كود + رابط + QR |
| من يدير؟ | مدير واحد (Admin) لكل مجموعة |
| أبناء بدون هاتف؟ | أعضاء ظِل يُضافون يدوياً بالاسم |
| شيخ + طلاب؟ | نفس النموذج، نوع مجموعة "قيادة" أو "مجموعة" |
| أصدقاء؟ | نفس النموذج، نوع "أصدقاء" |
| الخصوصية؟ | ملخص شامل فقط، بدون تفاصيل صلوات فرد |
| الإشعارات بين الأعضاء؟ | لاحقاً، بإعدادات دقيقة |

---

## 12. الخلاصة

- نموذج **مجموعة واحدة مرنة** يغطي: عائلة، شيخ+طلاب، أصدقاء.
- **كود + رابط + QR** لربط الناس بدون تعقيد.
- **أعضاء ظِل** لكل من لا يملك هاتفاً.
- **خصوصية تامة:** ملخص شامل فقط، لا تفاصيل فردية.
- **المرحلة الأولى:** بدون إشعارات بين الأعضاء؛ نضيفها لاحقاً بإعدادات واضحة.

هذا التصميم يوازن بين الربط الاجتماعي والخصوصية، ويستوعب كل السيناريوهات التي ذكرتها.
