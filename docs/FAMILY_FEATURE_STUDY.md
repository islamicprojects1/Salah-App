# ุฏุฑุงุณุฉ ุดุงููุฉ: ุตูุญุฉ ุงูุนุงุฆูุฉ โ ูุจ ุงูุชุทุจูู ูุฑุจุท ุงููุงุณ ูู ุงูุตูุงุฉ

## ุงูุฑุคูุฉ ุงูุฌููุฑูุฉ

> **ุตูุญุฉ ุงูุนุงุฆูุฉ ููุณุช ููุฒุฉ ุซุงูููุฉ. ูู ููุจ ุงูุชุทุจูู.**

ุงููุฏู ุงููุฑูุฒู: **ุฑุจุท ุงููุงุณ ูู ุงูุตูุงุฉ**. ููุณ ุชุชุจุน ุฃุฑูุงู X/Y ูุญุณุจุ ุจู ุฅุญุณุงุณ ุญู ุจุฃู ุงูุนุงุฆูุฉ ุชูุตููู ูุนุงู โ ุญุชู ููู ูุชุจุงุนุฏูู ุฌุบุฑุงููุงู.

**ุฑููุฒุชุงู ุฃุณุงุณูุชุงู:**
1. **Real-time ุดุฏูุฏ** โ ูู ุญุฏุซ ูุธูุฑ ููุฑุงู ุฏุงุฎู ุงูุชุทุจูู.
2. **ุฅุดุนุงุฑุงุช ุจูู ุงููุณุชุฎุฏููู** โ ูู ุญุฏุซ ููู ููุจููุบ ุจู ุจุงูู ุงูุนุงุฆูุฉ (FCM Push).

ูุฐุง ุงููุณุชูุฏ ููุฏูู ุงูุฎุทุฉ ุงููุงููุฉ: ุฑุคูุฉุ ุฃููุงุฑ ุฌุฑูุฆุฉุ ุฅุดุนุงุฑุงุชุ ููุณุงุฑ ุงูุชูููุฐ.

---

## 1. ููุฏ ุงููุซููุฉ ูุงูุชุตููู ุงูุญุงูู

### 1.1 ูุง ุงูุฐู ูุงู ูุงูุตุงูุ

ุงููุซููุฉ ุงูุณุงุจูุฉ ุฑููุฒุช ุนูู:
- ูุงุฆูุฉ ููุงู ุชูููุฉ (ุฃููุงูุ Cloud Functionุ Deep Link)
- ุชุญุณููุงุช ุณุทุญูุฉ (Pull-to-refreshุ Empty states)
- "Real-time" ุจุงูุงุณู ููุท โ Firestore Streams ููุฌูุฏุฉ ููููุง ูุง ุชูุชุฑุฌู ุฅูู ุชุฌุฑุจุฉ ุญูุฉ

**ูุง ุบุงุจ ุชูุงูุงู:**
1. **ุงูุฑุคูุฉ** โ ููุงุฐุง ุตูุญุฉ ุงูุนุงุฆูุฉุ ูุง ุงูุฐู ูุดุนุฑ ุจูุ
2. **ุงูุญุถูุฑ ุงููุญุธู** โ ููู ูุตููู **ุงูุขู**ุ ููู ููุชุธุฑุ
3. **ุงูุฑุจุท ุงูุนุงุทูู** โ ููู ูุดุนุฑ ุฃููุง ูุตูู "ูุน" ุนุงุฆูุชูุงุ
4. **ุงูุฃููุงุฑ ุงูุฌุฑูุฆุฉ** โ ูู ูุง ููุฌุฏ ูุงู ุชุญุณููุงุช ุชูููุฏูุฉ

### 1.2 ููุฏ ุงูุชุตููู ุงูุญุงูู

| ุงููุดููุฉ | ุงูุชูุงุตูู |
|---------|----------|
| **X/Y ุจุนุฏ ุงูุงูุชูุงุก** | ุงูููุฎุต ููุญุฏูุซ ุจุนุฏ ุชุณุฌูู ุงูุตูุงุฉ. ูุง ุฅุญุณุงุณ ุจุงููุญุธุฉ. |
| **ูุง ุญุถูุฑ ููุฑู** | ูุง ูุนุฑู ุงููุณุชุฎุฏู ููู ุตููู ุงูุขู ุฃู ููู ูุตููู ุงูุขู. |
| **ูุง ุงูุชุธุงุฑ ุฌูุงุนู** | ูุง ููุฌุฏ "ูฃ ูู ุงูุนุงุฆูุฉ ููุชุธุฑูู ุงูุธูุฑ". |
| **ูุง ุงุญุชูุงู ูุญุธู** | ุงูุชูุงู ุตูุงุฉ ุฃุญุฏ ูุง ููุชุฑุฌู ุฅูู ุชุฌุฑุจุฉ ูุดุชุฑูุฉ ููุฑูุฉ. |
| **FCM ูุญุฏูุง** | ุงูุฅุดุนุงุฑุงุช ุชูุจููุ ููู ุงูุชุฌุฑุจุฉ ุฏุงุฎู ุงูุชุทุจูู ูุง ุฒุงูุช "ุณุฌูุงุช". |
| **ุชุจููุจ ุซุงููู** | ุงูุนุงุฆูุฉ ูู ุชุงุจ ุซุงูู โ ุจูููุง ูุฌุจ ุฃู ุชููู ูุญูุฑุงู. |

---

## 2. ุงูุฑุคูุฉ ุงูุฌุฏูุฏุฉ: Real-Time Extremo

### ุงููุจุฏุฃ

> **ูู ุญุฏุซ ุตูุงุฉ ูุฌุจ ุฃู ูุธูุฑ ููุฑุงู ูููุดุนูุฑ ุจู ูู ุงููุญุธุฉ.**

- ุงููุณุชุฎุฏู ููุชุญ ุงูุชุทุจูู โ ูุฑู ููู ุตููู **ููุฐ ุฏูุงุฆู** ูููู **ูุตููู ุงูุขู**.
- ูุณุชุนุฏ ููุธูุฑ โ ูุนุฑู ุฃู "ุฃู ูุญูุฏ ูุณุงุฑุฉ ููุชุธุฑุงู ุงูุธูุฑ".
- ูุณุฌูู ุงูุตูุงุฉ โ ูุธูุฑ ููุฑุงู ููุนุงุฆูุฉ ูุน ุงุญุชูุงู ูุตูุฑ.
- ุงูุนุงุฆูุฉ ุชุตููู ูุนุงู โ ุฅุญุณุงุณ ุจุงูุชูุงุฌุฏ ุงููุดุชุฑู ุญุชู ุนู ุจูุนุฏ.

---

## 3. ุฃููุงุฑ ุฌุฑูุฆุฉ ูุตูุญุฉ ุงูุนุงุฆูุฉ ุงูุญูุฉ

### 3.1 ุจุซ ุงูุตูุงุฉ โ Prayer Broadcast

- ุฒุฑ **"ุฃูุง ุฃุตููู ุงูุขู"** ูุจู ุงูุฏุฎูู ูู ุงูุตูุงุฉ.
- ูุธูุฑ ูู ุตูุญุฉ ุงูุนุงุฆูุฉ ููุฑุงู: **"ุฃุญูุฏ ูุตููู ุงูุธูุฑ ุงูุขู"**.
- ูููุญ ุฅุญุณุงุณุงู ุจุงูุญุถูุฑ ุงููุดุชุฑู ุญุชู ูู ูู ูุงุญุฏ ูู ููุงูู.

**ุชูููุฐ:** ุญูู `prayingNow: { prayerName, startedAt }` ูู `members/{userId}`. Stream ููุฑุฃู ุงูุฌููุน.

---

### 3.2 ุดุงุดุฉ "ูู ูุตููู ุงูุขู"

- ูุณู ุนููู **ุซุงุจุช** ูู ุงูุตูุญุฉ ูุนุฑุถ ูู ุฃุนูู "ุฃูุง ุฃุตููู ุงูุขู".
- ุชุญุฏูุซ **ูุญุธู** (Firestore listener).
- ุงูููุฑ ุนูู ุงูุงุณู: ุตูุงุฉ ุฏุนุงุก ูุตูุฑุฉ "ุงูููู ุชูุจู ุตูุงุชู".

---

### 3.3 ุนุฏุงุฏ ุชูุงุฒูู ุฌูุงุนู

- **"ุงูุธูุฑ ุจุนุฏ ูง ุฏูุงุฆู"** ุนูู ูุณุชูู ุงูุนุงุฆูุฉ.
- ุชูุจูู: **"ูฃ ุฃูุฑุงุฏ ูู ุงูุนุงุฆูุฉ ููุชุธุฑูู ุงูุธูุฑ"**.
- ูุญููุฒ ุงูุงูุชุฒุงู ุจุงูููุนุฏ ูุนุงู.

---

### 3.4 ุงุญุชูุงู ูุญุธู ุนูุฏ ุงูุฅููุงู

- ุนูุฏ ุชุณุฌูู ุงูุตูุงุฉ โ ุธููุฑ ููุฑู ูู ุงูุนุงุฆูุฉ: **"ุฃู ูุญูุฏ ุฃูููุช ุงูุธูุฑ"**.
- ุฑุณูู ูุชุญุฑูุฉ ูุตูุฑุฉ (ูุซูุงู ุดุนูุฉ ุฃู ูุฑุฏุฉ).
- ุฑุณุงูุฉ ุฌูุงุนูุฉ: **"ูุง ุดุงุก ุงููู"** ุฃู ุฒุฑ ุชูุงุนูู.

---

### 3.5 ุบุฑูุฉ ุงูุชุธุงุฑ ูุจู ุงูุตูุงุฉ

- **"ูฃ ูู ุงูุนุงุฆูุฉ ููุชุธุฑูู ุงูุนุตุฑ"**.
- ุฒุฑ **"ุฃูุง ูุณุชุนุฏ"** โ ุฅุธูุงุฑ ุฃูู ุณุชุตููู ูุนูู ูู ููุณ ุงูุชูููุช.
- ูุนุทู ุฅุญุณุงุณุงู ุจุงูุงูุชุธุงุฑ ูุงูุชุฌููุฒ ุงูุฌูุงุนู.

**ุชูููุฐ:** ุญูู `waitingFor: prayerName` ูู ุงูุนุถู. ูููุณุญ ุชููุงุฆูุงู ุจุนุฏ ููุช ุงูุตูุงุฉ ุฃู ุนูุฏ ุงูุชุณุฌูู.

---

### 3.6 ุดุนูุฉ ุญูุฉ โ Live Family Flame

- ูุคุดุฑ ุจุตุฑู **ุญู** ูุชูุงุนู ูุน ุงููุดุงุท.
- ูู ุตูุงุฉ ูุณุฌููุฉ โ ุงูุดุนูุฉ ุชุชุญุฑู ุฃู ุชูุจุฑ ููููุงู.
- ูุนูุณ ุญุงูุฉ ุงูุนุงุฆูุฉ **ุงูููู** ุจูุญุธุฉุ ูููุณ ููุท X/Y ุซุงุจุชุงู.

---

### 3.7 ูุจุถ ุงูุนุงุฆูุฉ โ Live Pulse

- ุดุฑูุท ุนููู ุฃู ุณุทุฑ ูุชุญุฑู ูุนุฑุถ **ุขุฎุฑ ุงููุดุงุท ููุฑุงู**:
  - "ูุญูุฏ ุตููู ุงูุนุตุฑ ููุฐ ุฏูููุชูู"
  - "ุณุงุฑุฉ ุชุตููู ุงููุบุฑุจ ุงูุขู"
- ุชุญุฏูุซ **ููุฑู** ูู Firestore (ุฃู Realtime DB ุฅุฐุง ุงุญุชุฌูุง ุฃุณุฑุน).

---

### 3.8 ุชูุญูุฏ ุงูููุช โ "ุตูููุง ูุนุงู"

- ุงูุชุฑุงุญ: **"ุงูุนุงุฆูุฉ ูููุง ุชูุชุธุฑ ุงูุนุตุฑ โ ุตูู ุงูุขู"**.
- ูุฑุจุท ุงูููุนุฏ ุจุงูุฅุญุณุงุณ ุจุฃู ุงูุขุฎุฑูู ูู ููุณ ุงููุญุธุฉ.

---

### 3.9 ุฏุนุงุก ุชูุงุนูู

- ุนูุฏ ุธููุฑ "ุฃุญูุฏ ูุตููู ุงูุธูุฑ ุงูุขู" โ ุฒุฑ **"ุงูููู ุชูุจู"** ูุฑุณู ุฅุดุนุงุฑุงู ุฃู ุณุฌูุงู ุฏุงุฎููุงู.
- ูุนุฒูุฒ ุงูุฑุจุท ุงูุนุงุทูู ูุงูุฏุนุงุก ุงููุดุชุฑู.

---

## 4. ุฅุดุนุงุฑุงุช ุจูู ุงููุณุชุฎุฏููู โ ุงูุฅุทุงุฑ ุงููุงูู

> **ูู ุญุฏุซ ููู ุฏุงุฎู ุงูุนุงุฆูุฉ ูุฌุจ ุฃู ููุจููุบ ุจู ุงููุณุชุฎุฏู ุญุชู ูู ูู ููู ุงูุชุทุจูู ููุชูุญุงู.**

### 4.1 ุฌุฏูู ุงูุฅุดุนุงุฑุงุช

| ุงูุญุฏุซ | ุงููุฑุณู | ุงููุณุชูุจู | ูุต ุงูุฅุดุนุงุฑ (ุนุฑุจู) | ูุต ุงูุฅุดุนุงุฑ (ุฅูุฌููุฒู) |
|-------|--------|----------|-------------------|----------------------|
| **ูุตููู ุงูุขู** | ุฃุญูุฏ | ุจุงูู ุงูุนุงุฆูุฉ | ุฃุญูุฏ ูุตููู ุงูุธูุฑ ุงูุขู ๐คฒ ุงูููู ุชูุจู | Ahmed is praying Dhuhr now ๐คฒ May Allah accept |
| **ุฃููู ุตูุงุฉ** | ุฃู ูุญูุฏ | ุจุงูู ุงูุนุงุฆูุฉ | ุฃู ูุญูุฏ ุฃูููุช ุงูุธูุฑ ูุง ุดุงุก ุงููู ๐ | Um Mohammed completed Dhuhr Masha'Allah ๐ |
| **ุงูุถู ููุงูุชุธุงุฑ** | ุณุงุฑุฉ | ุจุงูู ุงูุนุงุฆูุฉ | ุณุงุฑุฉ ุชูุชุธุฑ ุงูุนุตุฑ โ ุตูููุง ูุนูุง! | Sara is waiting for Asr โ pray with her! |
| **ุฏุนุงุก "ุงูููู ุชูุจู"** | ูุญูุฏ | ุฃุญูุฏ (ุงููุตููู) | ูุญูุฏ ุฏุนุง ูู โ ุงูููู ุชูุจู ุตูุงุชู | Mohammed prayed for you โ May Allah accept your prayer |
| **ุชุดุฌูุน** | ุงูุฃุจ | ุงูุงุจู | ูุงูุฏู ูุดุฌูุนู ุนูู ุตูุงุฉ ุงููุบุฑุจ ๐ช | Your father encourages you for Maghrib ๐ช |
| **ุงูุนุงุฆูุฉ ูููุง ุตููุช** | โ | ุงูุนุงุฆูุฉ | ุงูุนุงุฆูุฉ ูููุง ุตููุช ุงูููู ๐ ูุง ุดุงุก ุงููู | The whole family prayed today ๐ Masha'Allah |
| **ุนุถู ุฌุฏูุฏ ุงูุถู** | โ | ุงููุฏูุฑ | ุฃุญูุฏ ุงูุถู ูุนุงุฆูุชู ๐ | Ahmed joined your family ๐ |

### 4.2 ูููุงุช ุงูุฅุดุนุงุฑุงุช

| ุงูููุงุฉ | ุงูุงุณุชุฎุฏุงู |
|--------|-----------|
| **FCM Push** | ุฅุดุนุงุฑุงุช ุนูุฏ ุบูู ุงูุชุทุจูู โ ูุฅููุงุธ ุงูุงูุชุจุงู ูุฑุจุท ุงููุณุชุฎุฏู. |
| **In-App** | ุฅุดุนุงุฑ ุฏุงุฎูู ุฃู ุชุญุฏูุซ ููุฑู ุนูุฏ ูุชุญ ุงูุชุทุจูู (Firestore Stream). |
| **ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู** | ุงุญุชุฑุงู "ุฅุดุนุงุฑุงุช ุงูุนุงุฆูุฉ" โ ุฅู ุนุทููุ ูุง ููุฑุณูู ูู FCM. |

### 4.3 Backend ููุฅุดุนุงุฑุงุช โ ุฎูุงุฑุงู

| ุงูุฎูุงุฑ | ุงููุทููุจ | ุงูุชูููุฉ | ููุงุญุธุงุช |
|--------|---------|---------|----------|
| **Cloud Functions** | ุฎุทุฉ Blaze + ุจุทุงูุฉ | ูุฌุงูู ุถูู ุญุฏูุฏุ ุจุนุฏูุง ูุฏููุน | ููุฏูุฌ ูุน Firebaseุ ุณูู ุงููุดุฑุ ูุชุทููุจ ุชูุนูู ุงูุฏูุน. |
| **Express + Firebase Admin** | ุงุณุชุถุงูุฉ (Railwayุ Renderุ VPS) | ุญุณุจ ุงูุงุณุชุถุงูุฉ (ููู ูุฌุงูู) | ูุง ูุญุชุงุฌ Blaze. ุฅุฑุณุงู FCM ูู ุณูุฑูุฑูุ ูุฑููุฉ ูุงููุฉ. |

**ุงูุชุฏูู (ุฃู ุฎูุงุฑ):**
1. ุงูุชุทุจูู ูุญุฏูุซ Firestore (ูุซูุงู `prayingNow` ุฃู `todayPrayers`).
2. Backend ูุฑุตุฏ ุงูุชุบููุฑ (Cloud Function trigger ุฃู Express + Firestore listener).
3. Backend ูุฑุณู FCM ุฅูู Topic `family_{groupId}` ุฃู ูู FCM token ุงููุณุชูุฏู.

### 4.4 ุจููุฉ ุฅุดุนุงุฑุงุช Express (ูุซุงู)

```
ุงูุชุทุจูู โ POST /api/prayer/log   (ุฃู ููุชุจ ูุจุงุดุฑุฉ Firestore)
Express โ ููุฑุฃ ุงูุชุญุฏูุซ (ุฃู ูุณุชูุน ูู Firestore)
Express โ admin.messaging().send({ topic: `family_${groupId}`, ... })
```

---

## 5. ุงูุญุงูุฉ ุงูุชูููุฉ ุงูุญุงููุฉ

### 5.1 ูุง ูู ููููููุฐ

| ุงูููููู | ุงูุญุงูุฉ | ุงูููุงุญุธุงุช |
|---------|--------|-----------|
| ุฅูุดุงุก ูุฌููุนุฉ | โ | Firestore + ูุงุด ูุญูู |
| ุงูุงูุถูุงู ุจููุฏ | โ | ุฏุนู `not_found`, `expired`, `blocked`, `already_member` |
| ูุงุฆูุฉ ุงูุฃุนุถุงุก | โ | Stream ูู Firestore |
| ุงูููุฎุต ุงููููู X/Y | โ | `prayedCount` / `totalMembers` |
| ุงูุฃุนุถุงุก ุงูุธู (Shadow) | โ | ุฅุถุงูุฉ ุฃุนุถุงุก ุจุฏูู ุญุณุงุจ |
| ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก | โ | ุทุฑุฏุ ุญุธุฑุ ููู ุงูุฅุฏุงุฑุฉ |
| ุชุฌุฏูุฏ ููุฏ ุงูุฏุนูุฉ | โ | ูููุฏูุฑ ููุท |
| ูุดุงุฑูุฉ ุงูููุฏ / ุงูุฑุงุจุท | โ | Share + Clipboard |
| ุฎูุงูุฉ ุงููุฏูุฑ | โ | ุชููุงุฆู ุนูุฏ ุงููุบุงุฏุฑุฉ ุฃู 90 ููู ุนุฏู ูุดุงุท |
| FCM Topics | โ | ุงุดุชุฑุงู ูู `family_{groupId}` |
| ุชุญุฏูุซ ุตูุงุฉ ุงูุนุถู | โ | `onPrayerLogged` โ Firestore |
| ุฅุนุฏุงุฏุงุช ุฅุดุนุงุฑุงุช ุงูุนุงุฆูุฉ | โ | ูู ุงูุฅุนุฏุงุฏุงุช |
| ุฏุนู RTL ูุงูุนุฑุจูุฉ | โ | ุชุฑุฌูุงุช ููุฌูุฏุฉ |

### 5.2 ูููู Firestore ุงูุญุงูู ููุง ููุถุงู

```
groups/{groupId}
  - name, type, inviteCode, inviteCodeExpiresAt
  - adminId, memberIds[], memberCount, blockedUserIds[]
  - lastAdminActivity, createdAt, createdBy

groups/{groupId}/members/{userId}
  - displayName, role, joinedAt, isActive, isShadow
  - todayPrayersDate, todayPrayers[]
  // โโโ ุฅุถุงูุงุช Real-Time โโโ
  - prayingNow: { prayerName, startedAt }     // ูุตููู ุงูุขู
  - waitingFor: prayerName | null             // ููุชุธุฑ ูุฐู ุงูุตูุงุฉ

groups/{groupId}/daily/{YYYY-MM-DD}
  - prayedCount, totalMembers, updatedAt
  - logged_today/{uid}

// โโโ ุฌุฏูุฏ: ูุจุถ ุงููุญุธุฉ โโโ
groups/{groupId}/activity/{activityId}
  - type: 'praying_now' | 'prayer_completed' | 'waiting'
  - memberId, memberName, prayerName, at (timestamp)
```

### 5.3 ุงููููุงุช ุงูุฑุฆูุณูุฉ

- `lib/features/family/controller/family_controller.dart`
- `lib/features/family/data/models/repositories/family_repository.dart`
- `lib/features/family/presentation/screens/family_screen.dart`
- `lib/features/family/presentation/widgets/` (FamilySummaryCard, InviteShareCard, MemberListTile, AddShadowMemberSheet)
- `lib/features/family/presentation/screens/create_group_screen.dart`, `join_group_screen.dart`

---

## 6. ุงููุฌูุงุช ูุงูุซุบุฑุงุช

### 6.1 ูุฌูุงุช ุญุฑุฌุฉ (ูุจู ุงูุฅุทูุงู)

| # | ุงููุฌูุฉ | ุงูุญู ุงูููุชุฑุญ |
|---|--------|--------------|
| 1 | ุฅุดุนุงุฑุงุช FCM ููุนุงุฆูุฉ | Cloud Function ุชูุดุบูู ุนูู ุชุญุฏูุซ `todayPrayers` ุฃู `prayingNow` ูุชุฑุณู ุฅูู Topic `family_{groupId}` |
| 2 | ุฑุงุจุท ุงูุฏุนูุฉ ุงูุนููู | ุถุจุท `salah://join/$code` ุฃู `https://salah.app/join/$code` ูุน App Links |
| 3 | ูุนุงูุฌุฉ ุงูุชูุงุก ุงูููุฏ | ุนุฑุถ `invite_code_expired` ูุฒุฑ ุชุฌุฏูุฏ ูููุฏูุฑ |
| 4 | Offline | ุญุงูุฉ "ูุง ุงุชุตุงู" ูุน ุฑุณุงูุฉ ูุงุถุญุฉ |
| 5 | ุฃููุงู ุซุงุจุชุฉ | ุงุณุชุจุฏุงู ุจู AppColors ูุฏุนู Dark/Light |
| 6 | ุฅุฏุงุฑุฉ ุงูุฃุฎุทุงุก | ุฅุธูุงุฑ AppFeedback ุนูุฏ ูุดู ุฃู ุนูููุฉ |
| 7 | ุณูุงุณุฉ ุงูุฎุตูุตูุฉ | ุฑุงุจุท ูุงุถุญ ูู ุงูุฅุนุฏุงุฏุงุช ูุตูุญุฉ ุฅูุดุงุก/ุงูุถูุงู ุงูุนุงุฆูุฉ |

### 6.2 ูุฌูุงุช Real-Time (ูุจ ุงูุฑุคูุฉ)

| # | ุงููุฌูุฉ | ุงูุญู |
|---|--------|------|
| 8 | ูุง "ูุตููู ุงูุขู" | ุฅุถุงูุฉ `prayingNow` ููุงุฌูุฉ ุจุซ ุงูุตูุงุฉ |
| 9 | ูุง "ููุชุธุฑ" | ุฅุถุงูุฉ `waitingFor` ูุบุฑูุฉ ุงูุชุธุงุฑ |
| 10 | ูุง ูุจุถ ูุญุธู | Stream ุนูู `activity` ุฃู `members` ูุน ููุชุฑุฉ ุญุณุจ ุงูููุช |
| 11 | ูุง ุงุญุชูุงู ูุญุธู | ุฑุณูู ูุชุญุฑูุฉ + ุฅุดุนุงุฑ ุฏุงุฎูู ุนูุฏ ุงูุชูุงู ุตูุงุฉ ุฃุญุฏ |
| 12 | ุงูุดุนูุฉ ุซุงุจุชุฉ | ุฑุจุท ุงูุดุนูุฉ ุจู Stream ูุชูุงุนู ูุน ูู ุตูุงุฉ |

---

## 7. ุฎุทุฉ ุงูุชุทููุฑ ุงููุงููุฉ

### ุงููุฑุญูุฉ 1 โ Real-Time ุงูุฃุณุงุณ

| ุงูุชุฑุชูุจ | ุงููููุฉ | ุงูุฌูุฏ |
|---------|--------|-------|
| 1 | ุฅุถุงูุฉ `prayingNow` ู`waitingFor` ูู MemberModel ู Firestore | 2โ3 ุณุงุนุงุช |
| 2 | ุดุงุดุฉ/ูุณู "ูู ูุตููู ุงูุขู" + ุฒุฑ "ุฃูุง ุฃุตููู ุงูุขู" | 3โ4 ุณุงุนุงุช |
| 3 | ุบุฑูุฉ ุงูุชุธุงุฑ "ููุชุธุฑูู ุงูุธูุฑ" + ุฒุฑ "ุฃูุง ูุณุชุนุฏ" | 2โ3 ุณุงุนุงุช |
| 4 | ูุจุถ ุงููุญุธุฉ (ุดุฑูุท ุฃู ูุงุฆูุฉ ุขุฎุฑ ุงููุดุงุท) | 3โ4 ุณุงุนุงุช |
| 5 | ุงุญุชูุงู ูุญุธู ุนูุฏ ุชุณุฌูู ุงูุตูุงุฉ (ุฏุงุฎู ุงูุชุทุจูู) | 2 ุณุงุนุงุช |
| 6 | ุดุนูุฉ ุญูุฉ ุชุชูุงุนู ูุน ุงููุดุงุท | 2โ3 ุณุงุนุงุช |

### ุงููุฑุญูุฉ 2 โ ุฅุดุนุงุฑุงุช ุจูู ุงููุณุชุฎุฏููู ูุงูุงุณุชูุฑุงุฑ

| ุงูุชุฑุชูุจ | ุงููููุฉ | ุงูุฌูุฏ |
|---------|--------|-------|
| 7 | **ุฅุดุนุงุฑุงุช FCM ุจูู ุงููุณุชุฎุฏููู** โ Backend (Cloud Functions ุฃู Express) ูุฑุณู: ูุตููู ุงูุขูุ ุฃููู ุตูุงุฉุ ุงูุชุธุงุฑุ ุฏุนุงุกุ ุชุดุฌูุน | 4โ6 ุณุงุนุงุช |
| 8 | ุงุณุชุจุฏุงู ุงูุฃููุงู ุงูุซุงุจุชุฉ ุจู AppColors | 1โ2 ุณุงุนุงุช |
| 9 | Deep Linkุ ุณูุงุณุฉ ุงูุฎุตูุตูุฉุ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุกุ Offline | 2โ3 ุณุงุนุงุช |
| 10 | Pull-to-refreshุ Empty states | 1 ุณุงุนุฉ |

### ุงููุฑุญูุฉ 3 โ ุชุนููู ุงูุฑุจุท

| ุงูุชุฑุชูุจ | ุงููููุฉ |
|---------|--------|
| 11 | ุฏุนุงุก ุชูุงุนูู "ุงูููู ุชูุจู" ุนูุฏ ุธููุฑ "ูุตููู ุงูุขู" |
| 12 | ุนุฏุงุฏ ุชูุงุฒูู ุฌูุงุนู "ุงูุธูุฑ ุจุนุฏ X โ ูฃ ููุชุธุฑูู" |
| 13 | ุชุณุฌูู ุตูุงุฉ ูุฏููุงู ูู Shadow (ุงููุฏูุฑ) |
| 14 | ุฅูุฌุงุฒุงุช ุนุงุฆููุฉ (ูุซูุงู: ุงูุนุงุฆูุฉ ุตููุช ูุนุงู 7 ุฃูุงู) |
| 15 | QR Code ููุงูุถูุงู |

---

## 8. Backend ููุฅุดุนุงุฑุงุช โ Cloud Functions ุฃู Express

### 8.1 ุฎูุงุฑ A: Cloud Functions

**ุฅุดุนุงุฑ ุนูุฏ "ูุตููู ุงูุขู"**
```
Trigger: Firestore onUpdate ุนูู members/{userId}
  ุนูุฏ ุชุบููุฑ prayingNow

Logic: ุฅุฐุง prayingNow != null
  โ ุฅุฑุณุงู ุฅูู Topic family_{groupId}
  โ "ุฃุญูุฏ ูุตููู ุงูุธูุฑ ุงูุขู โ ุงูููู ุชูุจู"
```

**ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุตูุงุฉ**

```
Trigger: Firestore onUpdate ุนูู members/{userId}
  ุนูุฏ ุชุบููุฑ todayPrayers (ุฅุถุงูุฉ ุตูุงุฉ ุฌุฏูุฏุฉ)

Logic:
  โ ุฅุฑุณุงู ุฅูู Topic family_{groupId}
  โ "ุฃู ูุญูุฏ ุฃูููุช ุงูุธูุฑ โ ูุง ุดุงุก ุงููู"
```

**ุฅุดุนุงุฑ "ุดุฌูุน" ุฃู "ุงูููู ุชูุจู"**

```
Trigger: Firestore onCreate ุนูู encouragements/{id}

Logic: ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุงููุณุชูุฏู ููุท
```

### 8.2 ุฎูุงุฑ B: Express + Firebase Admin

```
- ุณูุฑูุฑ Express ูุณุชูุน ูู Firestore (onSnapshot ุนูู groups/{groupId}/members)
- ุนูุฏ ุชุบููุฑ prayingNow ุฃู todayPrayers โ admin.messaging().send()
- ูุง ูุญุชุงุฌ ุฎุทุฉ Blaze
- ุงุณุชุถุงูุฉ: Railwayุ Renderุ ุฃู VPS
```

---

## 9. Firestore Rules (ููุชุทู)

```javascript
// ุงูุณูุงุญ ููุนุถู ุจุชุญุฏูุซ prayingNow ู waitingFor ูููุณู ููุท
match /groups/{groupId}/members/{memberId} {
  allow update: if request.auth.uid == memberId
    && onlyChanged(['prayingNow', 'waitingFor', 'todayPrayers', 'todayPrayersDate']);
  // ... ุจุงูู ุงูููุงุนุฏ
}
```

---

## 10. ุฎุฑูุทุฉ ุงููููุงุช ููุชุนุฏูู

| ุงูููู | ุงูุชุนุฏููุงุช |
|-------|-----------|
| `member_model.dart` | ุฅุถุงูุฉ `prayingNow`, `waitingFor` |
| `family_repository.dart` | ุฏูุงู `setPrayingNow`, `setWaitingFor`, Stream ูููุดุงุท ุงููุญุธู |
| `family_controller.dart` | Observables ููู Live Pulseุ ุงุณุชุฏุนุงุก ุฏูุงู ุงูุจุซ ูุงูุงูุชุธุงุฑ |
| `family_screen.dart` | ุฃูุณุงู: ูู ูุตููู ุงูุขูุ ุบุฑูุฉ ุงูุชุธุงุฑุ ูุจุถุ ุดุนูุฉ ุญูุฉ |
| `family_summary_card.dart` | ุดุนูุฉ ุญูุฉ + ุฃููุงู + animations |
| **ุฌุฏูุฏ** | `praying_now_banner.dart`, `waiting_room_section.dart`, `live_pulse_bar.dart` |
| **ุฌุฏูุฏ** | `functions/` โ Cloud Functions ุฃู ุณูุฑูุฑ Express |

---

## 11. ุงูุฎูุงุตุฉ

ุตูุญุฉ ุงูุนุงุฆูุฉ ูุฌุจ ุฃู ุชููู **ูุจ ุงูุชุทุจูู** ู**ุฑุจุท ุงููุงุณ ูู ุงูุตูุงุฉ**:

1. **Real-time ุดุฏูุฏ**: ูู ูุตููู ุงูุขูุ ููู ููุชุธุฑุ ุขุฎุฑ ุงููุดุงุท ูุญุธูุงู.
2. **ุญุถูุฑ ูุดุชุฑู**: ุจุซ ุงูุตูุงุฉุ ุบุฑูุฉ ุงูุชุธุงุฑุ ุงุญุชูุงู ูุญุธู.
3. **ุดุนูุฉ ุญูุฉ** ู**ูุจุถ ุงูุนุงุฆูุฉ** ูุนูุณุงู ุงููุญุธุฉ ูููุณ ููุท ุงููุชูุฌุฉ ุงูููุงุฆูุฉ.
4. **ุชูููุงู**: Firestore Listeners ููุซูุฉุ Backend (Cloud Functions ุฃู Express) ููุฅุดุนุงุฑุงุช ุจูู ุงููุณุชุฎุฏูููุ ุญููู ุฌุฏูุฏุฉ (`prayingNow`, `waitingFor`).
5. **ุฅุดุนุงุฑุงุช ุจูู ุงููุณุชุฎุฏููู**: ูู ุญุฏุซ ููู ููุจููุบ ุจู ุงูุนุงุฆูุฉ ุนุจุฑ FCM โ ูุตููู ุงูุขูุ ุฃููู ุตูุงุฉุ ุฏุนุงุกุ ุชุดุฌูุนุ ุงูุถูุงู.

ุงููุฏู: ุนูุฏูุง ููุชุญ ุงููุณุชุฎุฏู ุงูุชุทุจูู ูุดุนุฑ ุฃู ุนุงุฆูุชู **ููุง** โ ุชุตูููุ ุชูุชุธุฑุ ุชุญุชูู. ูุนูุฏูุง ูุบูู ุงูุชุทุจููุ ุงูุฅุดุนุงุฑุงุช ุชุฑุจุทู ุจุนุงุฆูุชู.

---

## 12. ุงูุชูุงุฏ ุฃุฎูุฑ ูููุซููุฉ

**ุงููุซููุฉ ูุง ุฒุงูุช ุชูุฎุทุฆ ูู ุงูุฃููููุฉ.**

ุฑููุฒูุง ุนูู ุงูุฃููุงุฑ ุงูุฌุฑูุฆุฉุ ููููุง ูู ูุญุฏูุฏ ุจูุถูุญ: **ูุงุฐุง ูู ูุดู ุงููุณุชุฎุฏู ูู ุงูุดุนูุฑ ุจุงูุฑุจุทุ** ุงููุซููุฉ ุชูุชุฑุถ ุฃู "ูุตููู ุงูุขู" ู"ุบุฑูุฉ ุงูุชุธุงุฑ" ูุงููุฉ. ููู ุงูุญูููุฉ ุฃู ุงูุฑุจุท ุงูุนุงุทูู ูุญุชุงุฌ ุฃูุซุฑ:

- **ูู ูุญุฏูุซ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ุงูุชุงุจ ุงูุฃูู)**: ุงูุนุงุฆูุฉ ุชุงุจ ุซุงูู. ุฅุฐุง ูุงูุช ุงูุนุงุฆูุฉ ูุจ ุงูุชุทุจููุ ููุงุฐุง ููุณุช ุงูุฃูููุ ุฃู ููุงุฐุง ูุง ุชููู ุงูุนุงุฆูุฉ ูุฏูุฌุฉ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ููุณู ุนูููุ
- **ูู ูุฃุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ุงููุณุชุฎุฏู ุงููุญูุฏ**: ูุงุฐุง ูุฑู ูู ููุณ ูู ุนุงุฆูุฉุ ูู ูุดุนุฑู ุจุงูููุต ุฃู ููุฏูู ูู ูููุฉ ุจุฏููุฉุ
- **ูู ูุฑุจุท ุงูุตูุงุฉ ุงููุนููุฉ ุจุงูุชุทุจูู**: ุงููุณุชุฎุฏู ูุถุบุท "ุฃูุง ุฃุตููู ุงูุขู" ุซู ูุบูู ุงูุชุทุจูู ููุตููู. ูู ูุฐูุฑูู ุจุงูุนูุฏุฉ ูุชุณุฌูู ุงูุฅููุงูุ ุฃู ูุนุชุจุฑ "ุฃูุง ุฃุตููู ุงูุขู" ููุงูุฉ ุงููุณุงุฑุ
- **ุงููุซููุฉ ูููุฆุฉ ุจุฃููุงุฑ ููู ุดุญูุญุฉ ุจุงูุชูุงุตูู**: ููู ุจุงูุถุจุท ูุจุฏู ูุณู "ูู ูุตููู ุงูุขู"ุ ูู ุซุงููุฉ ุชุญุฏูุซุ ูุงุฐุง ูู ูุงู ูกู ุฃุนุถุงุก ูุตููููุ ุงููุซููุฉ ุชุญุชุงุฌ ููุงุตูุงุช ุชูุตูููุฉ ูุจู ุงูุจุฑูุฌุฉ.

**ุงูุฎูุงุตุฉ:** ุงููุซููุฉ ุฎุทูุฉ ูุจูุฑุฉุ ููููุง ุชุญุชุงุฌ ูุฑุงุฑุงุช ุชุตููููุฉ ุญุงุณูุฉ: ููุงู ุงูุนุงุฆูุฉ ูู ุงูุชุทุจููุ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงููุญูุฏุ ูุฑุจุท "ุฃูุง ุฃุตููู ุงูุขู" ุจุชุณุฌูู ุงูุฅููุงู.

---

## 13. ุชูููู ุชุทููุฑ ุฃุฎูุฑ

**ูุง ุชุจุฑูุฌ ูุจู ุฃู ุชุฑุณูู.**

ูุจู ูุชุงุจุฉ ุณุทุฑ ูุงุญุฏ ูู `family_controller.dart` ุฃู `family_repository.dart`:

1. **ุงุฑุณู ุงูุดุงุดุฉ ูุฏููุงู** (ุนูู ูุฑูุฉ ุฃู Figma): ุฃูู ุจุงูุถุจุท ูุณู "ูู ูุตููู ุงูุขู"ุ ุฃูู ุบุฑูุฉ ุงูุงูุชุธุงุฑุ ุฃูู ุงููุจุถุ ูุง ุชุฑุชูุจ ุงูุนูุงุตุฑ ูู ุงูุฃุนูู ููุฃุณููุ
2. **ุญุฏูุฏ ุงูุชุฏูู**: ุงููุณุชุฎุฏู ูุถุบุท "ุฃูุง ุฃุตููู ุงูุขู" โ ูุงุฐุง ูุญุฏุซุ ูู ููุชูู ูุดุงุดุฉ ุงูุตูุงุฉ ุฃู ูุจูู ูู ุงูุนุงุฆูุฉุ ูุชู ูููุณุญ `prayingNow`ุ (ุจุนุฏ ูกู ุฏูุงุฆูุ ุนูุฏ ุชุณุฌูู ุงูุตูุงุฉุ ุนูุฏ ุงูุฎุฑูุฌ ูู ุงูุชุทุจููุ)
3. **ุญุฏูุฏ ุงูุฃููููุฉ ุงูุชูููุฐูุฉ**: ูุง ุชููููุฐ ูู ุดูุก ุฏูุนุฉ ูุงุญุฏุฉ. ุงุจุฏุฃ ุจู "ูู ูุตููู ุงูุขู" + "ุงุญุชูุงู ุนูุฏ ุงูุฅููุงู" ููุท. ุงุฎุชุจุฑููุง ูุน ุนุงุฆูุฉ ุญููููุฉ. ุซู ุฃุถู ุบุฑูุฉ ุงูุงูุชุธุงุฑ ูุงููุจุถ.
4. **ูููุณ ุงูุชูููุฉ**: Firestore Listeners ูุซูุฑุฉ = ูุฑุงุกุงุช ูุซูุฑุฉ = ุชูููุฉ. ุญุฏูุฏ: ูู ูุณูุน ูู `members` ุฃู ูุณูุน `activity` ููุทุ ุตููู ููููู ููููู ุงููุฑุงุกุงุช ูุน ุงูุญูุงุธ ุนูู Real-time.

**ุงูุชูููู:** ุงูุชุทููุฑ ุจุฏูู ุฑุณู ูุชุฏูู ูุงุถุญ = ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงุญูุงู. ุงููุซููุฉ ุฏูููุ ููู ุงูุชูุงุตูู ุชูุญุฏููุฏ ุนูู ุงููุฑู ูุจู ุงูููุฏ.
