# خطة التحقق والتنظيف الشاملة

مراجعة كل جزء في التطبيق من الصفر: وظائفه، تقسيم الملفات، إزالة غير المستخدم، والتأكد من الجودة.

---

## 1. Onboarding & Splash

### Onboarding
- [ ] **Splash screen**: التحميل، التوجيه الصحيح، منطق "عرض مرة واحدة"
- [ ] **Welcome page**: العرض، الترجمات، الأزرار
- [ ] **Features page**: عرض الميزات، التصميم
- [ ] **Family page**: شرح ميزة العائلة
- [ ] **Permissions page**: طلب الموقع والإشعارات، منطق السماح/الرفض
- [ ] **Profile setup**: إنشاء البروفايل الأولي
- [ ] **Complete step**: الانتقال للداشبورد أو تسجيل الدخول
- [ ] **Skip logic**: زر التخطي، متى يظهر، `canSkip`
- [ ] **حذف**: أي صفحة أو كود غير مستخدم في الـ onboarding

### Splash
- [ ] مدة الانتظار معقولة
- [ ] التوجيه حسب حالة المستخدم (مسجل / غير مسجل / أول مرة)
- [ ] استخدام `OnboardingMiddleware`

### تقسيم الملفات
- [ ] `onboarding_screen.dart` — هل > 300 سطر؟ تقسم إذا لزم
- [ ] `onboarding_controller.dart` — مراجعة الحجم والمنطق
- [ ] `splash_screen.dart` — مراجعة

---

## 2. Auth

### تسجيل الدخول / التسجيل
- [ ] **Login screen**: حقول البريد وكلمة المرور، التحقق، رسائل الخطأ
- [ ] **Register screen**: نفس الشيء + تأكيد كلمة المرور
- [ ] **Profile setup (post-register)**: الاسم، تاريخ الميلاد، الجنس
- [ ] **AuthService**: `signIn`, `signUp`, `signOut`, `authStateChanges`
- [ ] **تحقق المدخلات**: البريد، طول كلمة المرور، لا حقول فارغة
- [ ] **تسجيل الخروج**: مربع تأكيد قبل الخروج

### حذف
- [ ] أي شاشات أو دوال auth غير مستخدمة

### تقسيم الملفات
- [ ] `login_screen.dart` (حاليًا ~402 سطر)
- [ ] `auth_service.dart` (~311 سطر)
- [ ] فصل مكونات مشتركة (مثل حقول الإدخال) إن لزم

---

## 3. Settings

### الإعدادات
- [ ] **الهوية**: الموقع، طريقة الحساب، المذهب، ضبط المواقيت
- [ ] **التخصيص**: اللغة، الثيم (فاتح/داكن/تلقائي)
- [ ] **الإشعارات**: تفاصيل الإشعارات (في `NotificationSettingsView`)
- [ ] **البروفايل**: الصورة، الاسم، البريد
- [ ] **الدعم**: تقرير bug، اقتراح ميزة، تقييم التطبيق
- [ ] **تسجيل الخروج** و **حذف الحساب**

### الألوان والثيم
- [ ] استخدام `Theme.of(context)` بدل الألوان المباشرة حيث يناسب
- [ ] التحقق من `AppColors` و `AppTheme`
- [ ] الدعم الكامل للوضع الداكن

### تقسيم الملفات
- [ ] `settings_screen.dart` (~615 سطر) — تقسم أكثر إن أمكن
- [ ] `settings_controller.dart` (~519 سطر)
- [ ] `notification_settings_view.dart` ✓ (مستخرج)
- [ ] `settings_pickers.dart` ✓ (مستخرج)

---

## 4. Family

### العائلة
- [ ] **لوحة العائلة**: عرض الأعضاء، التقدم، النبض
- [ ] **إنشاء عائلة**: الاسم، التحقق، النجاح/الخطأ
- [ ] **الانضمام**: كود الدعوة، التحقق
- [ ] **إضافة طفل**: الاسم، تاريخ الميلاد، الجنس
- [ ] **شجّعه**: زر التشجيع، مؤشر التحميل، الإشعار
- [ ] **تسجيل صلاة لعضو**: للأطفال (من الوالد)
- [ ] **FamilyService**: إنشاء، انضمام، نبض، إشعارات
- [ ] **Firestore**: `memberIds`، قواعد الأمان

### حذف
- [ ] أي كود عائلة قديم أو غير مستخدم

### تقسيم الملفات
- [ ] `family_dashboard_screen.dart` (~313 سطر)
- [ ] `family_service.dart` (~764 سطر) — تقسيم منطقي
- [ ] `family_controller.dart`
- [ ] `family_member_card.dart` (~399 سطر)

---

## 5. Clock / Dashboard

### الساعة والداشبورد
- [ ] **عداد التنازل**: دقة التحديث، عرض "الصلاة التالية"
- [ ] **الصلاة التالية بعد العشاء**: الفجر لليوم التالي
- [ ] **الدائرة الذكية**: `SmartPrayerCircle`، عرض الوقت، التحديث
- [ ] **تسجيل الصلاة**: زر، إشعار نجاح، تحديث الـ UI
- [ ] **تسجيل الصلاة من الإشعار**: `pendingPrayerLog`
- [ ] **الشريط الجانبي**: `Obx` المنعزل، لا إعادة بناء كاملة
- [ ] **موقع افتراضي**: عرض تنبيه عند استخدام مكة كمكان افتراضي

### تحسينات
- [ ] عزل `Obx` لمنطقة العداد فقط ✓
- [ ] استخدام الـ cache لمواقيت الصلاة ✓
- [ ] إلغاء الـ streams في `onClose` ✓

### تقسيم الملفات
- [ ] `dashboard_screen.dart` (~648 سطر)
- [ ] `dashboard_controller.dart` (~718 سطر)
- [ ] `smart_prayer_circle.dart` (~528 سطر)

---

## 6. Prayer Times & Logic

### المواقيت
- [ ] **PrayerTimeService**: الحساب، الـ cache، التحديث
- [ ] **DatabaseHelper**: `cachePrayerTimes`, `getCachedPrayerTimes`
- [ ] **الموقع**: GPS، اختيار مدينة يدوي
- [ ] **طريقة الحساب والمذهب**: من الإعدادات وتطبيقها فورًا

### الإشعارات
- [ ] **NotificationService**: الأذان، التذكير، الاقتراب، التكبير
- [ ] **الأصوات**: ملفات الـ assets، الـ raw، الإعدادات
- [ ] **إلغاء الإشعارات**: عند تسجيل الصلاة

### حذف
- [ ] `OfflineSyncService` إن وُجد — تم إزالته سابقًا
- [ ] أي كود إشعارات قديم أو مكرر

### تقسيم الملفات
- [ ] `notification_service.dart` (~747 سطر)
- [ ] `prayer_time_service.dart` (~469 سطر)

---

## 7. Colors & Theme

### مراجعة
- [ ] **AppColors**: الألوان الأساسية، الثانوية، الخلفية، النص
- [ ] **AppTheme**: `light`, `dark`, `system`
- [ ] **استخدام `Theme.of(context)`** في الشاشات الرئيسية
- [ ] **التباين**: قراءة واضحة في الوضعين
- [ ] **حذف**: ألوان غير مستخدمة من `AppColors`

---

## 8. عام: Services & Cleanup

### الخدمات
- [ ] **AuthService**
- [ ] **LocationService**
- [ ] **StorageService**
- [ ] **DatabaseHelper**
- [ ] **PrayerTimeService**
- [ ] **NotificationService**
- [ ] **LiveContextService**
- [ ] **FamilyService**
- [ ] **SyncService**
- [ ] **ThemeService**, **LocalizationService**

### Feedback & Logging
- [ ] استبدال كل `Get.snackbar` بـ `AppFeedback` ✓
- [ ] استبدال الـ catch الصامتة بـ `AppLogger` في المواقع الحرجة ✓

### حذف
- [ ] أي import غير مستخدم
- [ ] أي ملف أو كلاس أو دالة غير مستخدمة
- [ ] أي تعليق قديم أو شفرة مكررة

---

## 9. تقسيم الملفات (حد 300 سطر)

### ملفات تتجاوز 300 سطر حالياً

| الملف | الأسطر | الحالة |
|-------|--------|--------|
| settings_screen.dart | ~615 | يحتاج تقسيم |
| dashboard_screen.dart | ~648 | يحتاج تقسيم |
| dashboard_controller.dart | ~718 | يحتاج تقسيم |
| family_service.dart | ~764 | يحتاج تقسيم |
| notification_service.dart | ~747 | يحتاج تقسيم |
| smart_prayer_circle.dart | ~528 | يحتاج تقسيم |
| settings_controller.dart | ~519 | يحتاج تقسيم |
| prayer_time_service.dart | ~469 | يحتاج تقسيم |
| drawer.dart | ~464 | يحتاج تقسيم |
| login_screen.dart | ~402 | يحتاج تقسيم |
| family_member_card.dart | ~399 | يحتاج تقسيم |
| prayer_repository.dart | ~401 | يحتاج تقسيم |
| missed_prayers_screen.dart | ~381 | يحتاج تقسيم |
| profile_screen.dart | ~359 | يحتاج تقسيم |
| qada_review_bottom_sheet.dart | ~349 | يحتاج تقسيم |
| family_dashboard_screen.dart | ~313 | يحتاج تقسيم |
| firestore_service.dart | ~331 | يحتاج تقسيم |

---

## ترتيب التنفيذ المقترح

1. **Onboarding & Splash** — مراجعة التدفق، إصلاح الأخطاء، تقسيم إن لزم
2. **Auth** — نفس الشيء
3. **Settings** — مراجعة، ألوان، تقسيم
4. **Family** — مراجعة، Firestore، تقسيم
5. **Dashboard / Clock** — مراجعة المواقيت والعداد، تقسيم
6. **Prayer Times & Notifications** — مراجعة، تقسيم
7. **Colors & Theme** — مراجعة نهائية
8. **حذف الكود غير المستخدم** — في كل المجلدات
9. **تقسيم الملفات الكبيرة** — حسب الجدول أعلاه

---

## ملاحظات

- ركّز على **الوظائف أولاً** ثم **التقسيم** ثم **الحذف**.
- لا تضيف ميزات جديدة أثناء المراجعة.
- استخدم `AppFeedback` و `AppLogger` بدل البدائل القديمة.
- تأكد أن كل ملف لا يتجاوز **300 سطر** بعد التقسيم.
