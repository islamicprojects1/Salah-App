# CLAUDE_MASTER_PROMPT.md
> ÙˆØ«ÙŠÙ‚Ø© Ù…Ø±Ø¬Ø¹ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” Ø§Ù‚Ø±Ø£Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹ ÙÙŠ ÙƒÙ„ Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„.
> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ÙØ¨Ø±Ø§ÙŠØ± 2026

---

## 1. ÙÙ‡Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆÙ‡Ø¯ÙÙ‡

### Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡ÙˆÙŠØ©
- **Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù**: Qurb (Ù‚ÙØ±Ø¨) â€” Ø±Ø¨Ø· Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ† Ø­ÙˆÙ„ Ø§Ù„ØµÙ„Ø§Ø©
- **Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±**: ØµÙ„Ø§Ø© (Salah)
- **Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹**: `c:\development\Salah-App`
- **Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ**: `main` | **Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ**: `feature/many`

### Ø±Ø¤ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
ØªØ·Ø¨ÙŠÙ‚ Flutter Ø¥Ø³Ù„Ø§Ù…ÙŠ ÙŠÙÙ…ÙƒÙ‘Ù† Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ† Ù…Ù†:
1. **ØªØªØ¨Ø¹ Ø§Ù„ØµÙ„ÙˆØ§Øª** â€” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù…Ø¹ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª
2. **Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©** â€” Ø±Ø¨Ø· Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø³ÙŠØ±Ø© Ø§Ù„ØµÙ„Ø§ØªÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¬Ù…Ø§Ø¹ÙŠ
3. **Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯** â€” ØªØªØ¨Ø¹ ØµÙ„ÙˆØ§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¡ ÙˆØ§Ù„ØªØ´Ø¬ÙŠØ¹ Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¦Ù‡Ø§
4. **Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©** â€” Ø£Ø°Ø§Ù†ØŒ ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„ØµÙ„Ø§Ø©ØŒ ØªØ´Ø¬ÙŠØ¹ Ø¹Ø§Ø¦Ù„ÙŠ

### Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
Ù…Ø³Ù„Ù… Ø¹Ø±Ø¨ÙŠ ÙŠØ±ÙŠØ¯ Ø£Ù† ÙŠØµÙ„ÙŠ ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§ ÙˆØ£Ù† ÙŠØ±Ù‰ Ø¹Ø§Ø¦Ù„ØªÙ‡ ØªØµÙ„ÙŠ Ù…Ø¹Ù‡. Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠÙØ¯ÙŠÙ†ØŒ Ø¨Ù„ ÙŠÙØ´Ø¬Ø¹ ÙˆÙŠÙØ±Ø§ÙÙ‚.

---

## 2. Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©

### Stack Ø§Ù„ØªÙ‚Ù†ÙŠ
| Ø§Ù„Ø·Ø¨Ù‚Ø© | Ø§Ù„ØªÙ‚Ù†ÙŠØ© |
|--------|---------|
| UI | Flutter + Material 3 |
| State Management | GetX (Rx, Controller, Service, Binding) |
| Dependency Injection | GetIt (service locator) |
| Cloud Database | Firebase Firestore |
| Authentication | Firebase Auth (Email + Google) |
| Push Notifications | Firebase Messaging (FCM) |
| Local Database | SQLite (sqflite) |
| Local Storage | GetStorage (key-value) |
| Prayer Times API | Aladhan API (HTTP) |
| Location | Geolocator + Nominatim (reverse geocoding) |
| Images | Cloudinary (CDN) |
| Notifications | flutter_local_notifications |
| Compass | flutter_compass (Qibla) |
| Animations | Lottie |
| Audio | audioplayers (Adhan) |

### Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª

```
lib/
â”œâ”€â”€ main.dart                    # Entry point: Firebase init, DI, orientation
â”œâ”€â”€ app.dart                     # GetMaterialApp root, theme/locale reactive
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ api_constants.dart   # Firestore paths, channel IDs, timeouts
â”‚   â”‚   â”œâ”€â”€ aladhan_constants.dart # Countryâ†’MethodID mapping (40+ countries)
â”‚   â”‚   â”œâ”€â”€ enums.dart           # 30+ enums (PrayerName, PrayerTimingQuality, ...)
â”‚   â”‚   â”œâ”€â”€ storage_keys.dart    # 40+ typed keys for GetStorage
â”‚   â”‚   â”œâ”€â”€ app_dimensions.dart  # Spacing, breakpoints, border radius
â”‚   â”‚   â””â”€â”€ image_assets.dart    # Asset paths centralized
â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â””â”€â”€ injection_container.dart  # GetIt registration (190+ lines)
â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â””â”€â”€ app_logger.dart      # 4-level logger (debug/info/warning/error)
â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â”œâ”€â”€ app_feedback.dart    # Haptics + toasts + dialogs
â”‚   â”‚   â”œâ”€â”€ toast_service.dart   # Overlay-based toasts
â”‚   â”‚   â”œâ”€â”€ toast_widget.dart    # Animated toast UI
â”‚   â”‚   â””â”€â”€ sync_status.dart     # SyncState observable
â”‚   â”œâ”€â”€ helpers/
â”‚   â”‚   â”œâ”€â”€ date_time_helper.dart     # Gregorian formatting, cache keys
â”‚   â”‚   â”œâ”€â”€ hijri_date_helper.dart    # Hijri conversion, Ramadan detection
â”‚   â”‚   â”œâ”€â”€ prayer_names.dart         # Single source: PrayerNameâ†”Display
â”‚   â”‚   â”œâ”€â”€ prayer_timing_helper.dart # Qualityâ†’Color/Icon/Label mapping
â”‚   â”‚   â”œâ”€â”€ input_validators.dart     # (sanitisedValue, error?) records
â”‚   â”‚   â””â”€â”€ image_helper.dart         # Provider resolution, build widget
â”‚   â”œâ”€â”€ localization/
â”‚   â”‚   â”œâ”€â”€ languages.dart        # GetX Translations registry
â”‚   â”‚   â”œâ”€â”€ ar_translations.dart  # Arabic strings map
â”‚   â”‚   â””â”€â”€ en_translations.dart  # English strings map
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ onboarding_middleware.dart # Route guard for onboarding
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ app_routes.dart       # String constants for routes
â”‚   â”‚   â””â”€â”€ app_pages.dart        # GetPage definitions with bindings
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ storage_service.dart       # GetStorage wrapper
â”‚   â”‚   â”œâ”€â”€ database_helper.dart       # SQLite init, CRUD, sync queue
â”‚   â”‚   â”œâ”€â”€ connectivity_service.dart  # Network status (reactive)
â”‚   â”‚   â”œâ”€â”€ location_service.dart      # GPS + city lookup
â”‚   â”‚   â””â”€â”€ cloudinary_service.dart    # Image upload/optimize
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ app_colors.dart       # Color palette (Islamic green + gold)
â”‚   â”‚   â”œâ”€â”€ app_fonts.dart        # Tajawal (AR) + Poppins (EN) typography
â”‚   â”‚   â””â”€â”€ app_theme.dart        # Light/dark ThemeData
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ app_button.dart       # Primary/outlined/text/destructive
â”‚       â”œâ”€â”€ app_text_field.dart   # Input field with validation
â”‚       â”œâ”€â”€ app_dialog.dart       # Dialog wrapper
â”‚       â”œâ”€â”€ app_dialogs.dart      # Loading/confirmation dialogs
â”‚       â”œâ”€â”€ app_loading.dart      # Progress indicator
â”‚       â”œâ”€â”€ connection_status_indicator.dart
â”‚       â””â”€â”€ empty_state.dart
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/                    # Email + Google sign-in
â”‚   â”œâ”€â”€ prayer/                  # Core: times, logging, streaks, Qibla
â”‚   â”œâ”€â”€ family/                  # Groups: create, join, pulse, member cards
â”‚   â”œâ”€â”€ onboarding/              # Welcome â†’ Features â†’ Permissions â†’ Profile
â”‚   â”œâ”€â”€ settings/                # Theme, language, notifications, calc method
â”‚   â”œâ”€â”€ shell/                   # Main shell with bottom nav tabs
â”‚   â”œâ”€â”€ profile/                 # User profile + photo
â”‚   â”œâ”€â”€ stats/                   # Heatmap, streaks, completion %
â”‚   â””â”€â”€ splash/                  # Loading screen
â”‚
â””â”€â”€ shared/
    â””â”€â”€ data/
        â”œâ”€â”€ models/              # AchievementModel, AdminModels
        â””â”€â”€ repositories/
            â””â”€â”€ base_repository.dart
```

### ØªØ¯ÙÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
```
Splash â†’ [check onboarding]
    â”œâ”€â”€ Ù„Ù… ÙŠÙÙƒÙ…Ù„ â†’ Onboarding (Welcomeâ†’Featuresâ†’Permissionsâ†’ProfileSetup)
    â”‚                    â†“
    â””â”€â”€ Ø£ÙƒÙ…Ù„ â†’ [check auth]
                   â”œâ”€â”€ ØºÙŠØ± Ù…Ø³Ø¬Ù„ â†’ Login/Register
                   â””â”€â”€ Ù…Ø³Ø¬Ù„ â†’ MainShell (Dashboard | Family tabs)
```

---

## 3. Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ø±Ù…Ø©

> **Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙƒØ³Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹. Ø£ÙŠ ÙƒÙˆØ¯ ÙŠØ®Ø§Ù„ÙÙ‡Ø§ ÙŠØ¬Ø¨ ØªØµØ­ÙŠØ­Ù‡.**

### Q1 â€” Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø§Ø³ØªØ®Ø¯Ù… `AppFeedback` ÙÙ‚Ø·
```dart
// âœ… ØµØ­
AppFeedback.showSuccess('prayer_logged'.tr);
AppFeedback.showError('network_error'.tr);

// âŒ Ø®Ø·Ø£
Get.snackbar('title', 'message');
ScaffoldMessenger.of(context).showSnackBar(...);
print('error occurred');
```

### Q2 â€” Ø§Ù„ØªØ³Ø¬ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ù… `AppLogger` ÙÙ‚Ø·
```dart
// âœ… ØµØ­
AppLogger.info('DashboardController: prayer logged');
AppLogger.error('PrayerRepository: sync failed', error, stackTrace);

// âŒ Ø®Ø·Ø£
print('something');
debugPrint('debug info');
```

### Q3 â€” Ø§Ù„ØªØ±Ø¬Ù…Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± `.tr`
```dart
// âœ… ØµØ­
Text('prayer_fajr'.tr)
AppFeedback.showSuccess('streak_updated'.tr)

// âŒ Ø®Ø·Ø£
Text('Ø§Ù„ÙØ¬Ø±')
Text('Fajr Prayer')
```

### Q4 â€” Ø§Ù„Ù€ DI: Ø§Ù„ÙØµÙ„ Ø¨ÙŠÙ† `GetIt.I<T>()` Ùˆ `Get.find<T>()`
- **GetxService** (ÙŠØ¹ÙŠØ´ Ø·ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚): Ø³Ø¬Ù‘Ù„Ù‡ ÙÙŠ `GetIt` ÙˆØ§Ø³ØªØ®Ø¯Ù… `GetIt.I<T>()`
- **GetxController** (Ù…Ø±ØªØ¨Ø· Ø¨Ù€ route): Ø³Ø¬Ù‘Ù„Ù‡ ÙÙŠ `Binding` ÙˆØ§Ø³ØªØ®Ø¯Ù… `Get.find<T>()`
```dart
// âœ… ØµØ­ â€” service
final auth = GetIt.I<AuthService>();

// âœ… ØµØ­ â€” controller
final ctrl = Get.find<DashboardController>();
```

### Q5 â€” UI Constants: Ø§Ø³ØªØ®Ø¯Ù… `AppColors`, `AppFonts`, `AppDimensions`
```dart
// âœ… ØµØ­
Container(
  color: AppColors.primary,
  padding: EdgeInsets.all(AppDimensions.md),
  child: Text('label', style: AppFonts.bodyMedium),
)

// âŒ Ø®Ø·Ø£
Container(color: Color(0xFF1B5E20), padding: EdgeInsets.all(16))
```

### Q6 â€” Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙ„ÙˆØ§Øª: Ø§Ø³ØªØ®Ø¯Ù… `PrayerName` enum ÙÙ‚Ø·
```dart
// âœ… ØµØ­
final name = PrayerName.fajr;
PrayerNamesHelper.getArabicName(name);

// âŒ Ø®Ø·Ø£
final name = 'Fajr';
final name = 'fajr';
```

### Q7 â€” Scope of Obx: Ø¶ÙŠÙ‘Ù‚ Ù†Ø·Ø§Ù‚ Obx Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†
```dart
// âœ… ØµØ­ â€” only rebuilds the Text
Obx(() => Text(controller.currentStreak.value.toString()))

// âŒ Ø®Ø·Ø£ â€” rebuilds entire screen
Obx(() => Scaffold(body: Column(children: [...])))
```

### Q8 â€” Dispose: Ø£Ù„ØºÙ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙÙŠ onClose
```dart
// âœ… ÙŠØ¬Ø¨ ØªÙ†ÙÙŠØ°Ù‡ ÙÙŠ ÙƒÙ„ controller
@override
void onClose() {
  _timer?.cancel();
  _subscription?.cancel();
  super.onClose();
}
```

---

## 4. Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ© â€” Ù…Ø±ØªØ¨Ø© Ø¨Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©

### ğŸ”´ P0 â€” Ø­Ø±Ø¬ / ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø£Ù…Ø§Ù†

| # | Ø§Ù„Ù…Ø´ÙƒÙ„Ø© | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ØªØ£Ø«ÙŠØ± |
|---|---------|-------|---------|
| 1 | **ØªØ§ÙŠØ¨Ùˆ `oderId`** Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† `userId` ÙÙŠ `PrayerLogModel` | `prayer_log_model.dart` | ÙƒÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ field Ù…ÙƒØ³ÙˆØ± |
| 2 | **Stream subscription leaks** ÙÙŠ DashboardController Ùˆ FamilyController | `dashboard_controller.dart` | ØªØ³Ø±Ø¨ Ø°Ø§ÙƒØ±Ø©ØŒ crashes Ø¨Ø¹Ø¯ ÙØªØ±Ø© |
| 3 | **FCM ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ ÙØ¹Ù„ÙŠØ§Ù‹** â€” `subscribeToFamily()` Ù„Ø§ ÙŠÙØ³ØªØ¯Ø¹Ù‰ Ø£Ø¨Ø¯Ø§Ù‹ØŒ Server Key Ù…ÙÙ‚ÙˆØ¯ | `family_controller.dart`, `fcm_service.dart` | Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© Ù„Ø§ ØªØ¹Ù…Ù„ |
| 4 | **Family feature Ù…Ø­Ø°ÙˆÙØ©** â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ `FamilyService` ÙØ¹Ù„ÙŠØ§Ù‹ | `features/family/` | Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ÙƒØ³ÙˆØ±Ø© |
| 5 | **Google Sign-In ÙŠÙØ´Ù„** â€” SHA-1 ØºÙŠØ± Ù…Ø¶Ø§Ù ÙÙŠ Firebase Console | `google-services.json` | Google Sign-in Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙÙŠ release |

### ğŸŸ  P1 â€” Ø¹Ø§Ù„ÙŠ / ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

| # | Ø§Ù„Ù…Ø´ÙƒÙ„Ø© | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ØªØ£Ø«ÙŠØ± |
|---|---------|-------|---------|
| 6 | **ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚** â€” ÙŠÙØ­Øµ WiFi ÙˆÙ„ÙŠØ³ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„ÙØ¹Ù„ÙŠ | `connectivity_service.dart` | ÙŠØ¹ØªÙ‚Ø¯ Ø£Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„ Ø¨ÙŠÙ†Ù…Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ |
| 7 | **`PrayerQuality` enum Ù‚Ø¯ÙŠÙ…** Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ Ø±ØºÙ… Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù€ @Deprecated | Ù…ØªØ¹Ø¯Ø¯ | ØªÙ†Ø§Ù‚Ø¶ ÙÙŠ ØªÙ…Ø«ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙ„Ø§Ø© |
| 8 | **Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Auth Ù…ÙƒØªÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±** ÙˆÙ„ÙŠØ³ Ø¹Ø¨Ø± Ù…ÙØ§ØªÙŠØ­ ØªØ±Ø¬Ù…Ø© | `auth_error_messages.dart` | Ù„Ø§ ØªØªØºÙŠØ± Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© |
| 9 | **prayer offsets Ù…Ø®Ø²Ù†Ø© Ø¨Ù€ String key** Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† `PrayerName` enum | `user_model.dart`, `settings_controller.dart` | Ø§Ø­ØªÙ…Ø§Ù„ Ø®Ø·Ø£ Ø¥Ù…Ù„Ø§Ø¦ÙŠ ÙŠÙƒØ³Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ |
| 10 | **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©** â€” Ù…Ø´ÙƒÙ„Ø© Ø¹Ù†Ø¯ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡ Ù…Ø§Ø°Ø§ ÙŠØ¹Ø±Ø¶ØŸ) | `live_context_service.dart`, `dashboard_controller.dart` | Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ù„ÙŠÙ„Ø§Ù‹ |
| 11 | **Onboarding ÙŠØ­ØªÙˆÙŠ ØµÙØ­Ø© Family** (ØµÙØ­Ø© 3) Ù„Ù… ØªØ¹Ø¯ ÙÙŠ Ø§Ù„Ù€ spec | `onboarding_controller.dart` | ØªØ¬Ø±Ø¨Ø© ØªÙ‡ÙŠØ¦Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© |
| 12 | **AppLogger Ù„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ù„Ù€ Crashlytics** ÙÙŠ release | `app_logger.dart` | Ù„Ø§ Ø±Ø¤ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ |

### ğŸŸ¡ P2 â€” Ù…ØªÙˆØ³Ø· / ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØµÙŠØ§Ù†Ø©

| # | Ø§Ù„Ù…Ø´ÙƒÙ„Ø© | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ØªØ£Ø«ÙŠØ± |
|---|---------|-------|---------|
| 13 | **DI container Ø¶Ø®Ù…** (190+ Ø³Ø·Ø±) Ø¨Ø¯ÙˆÙ† code generation | `injection_container.dart` | ØµØ¹Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ØµÙŠØ§Ù†Ø© |
| 14 | **Ø£Ø³Ù…Ø§Ø¡ routes Ù…ÙƒØ±Ø±Ø©** (`createFamily` = `createGroup`, `joinFamily` = `joinGroup`) | `app_routes.dart` | Ø§Ø±ØªØ¨Ø§Ùƒ ÙÙŠ Ø§Ù„ØªÙ†Ù‚Ù„ |
| 15 | **ØªÙ†Ø§Ù‚Ø¶ camelCase/snake_case** ÙÙŠ Firestore fields | models Ù…ØªØ¹Ø¯Ø¯Ø© | ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØªØ¨Ø¹ |
| 16 | **Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Ø¹Ø§Ù…Ø©** Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø§ ØªØ­Ø¯Ø¯ Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„ | Ù…ØªØ¹Ø¯Ø¯ | ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø¶Ø¹ÙŠÙØ© |
| 17 | **Ø§Ù„Ù€ README Ù…Ù„Ù Flutter boilerplate** ÙˆÙ„ÙŠØ³ ØªÙˆØ«ÙŠÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ | `README.md` | ÙŠÙØ´ÙˆÙ‘Ø´ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ |
| 18 | **Admin succession** ØºÙŠØ± Ù…Ø­Ø¯Ø¯ â€” Ù…Ø§Ø°Ø§ Ù„Ùˆ ØºØ§Ø¯Ø± admin Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ | family models | Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¹Ø§Ù„Ù‚Ø© Ø¨Ø¯ÙˆÙ† admin |
| 19 | **invite code Ù„Ø§ ÙŠÙ†ØªÙ‡ÙŠ** â€” ÙŠÙ…ÙƒÙ† Ø¥Ø³Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… | `group_model.dart` | Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª |
| 20 | **Shadow member migration** â€” Ù…Ø³Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø¹Ø¶Ùˆ ÙˆÙ‡Ù…ÙŠ Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ | family feature | Ø§Ù„ÙÙƒØ±Ø© Ù…ÙˆØ«Ù‚Ø© Ù„ÙƒÙ† ØºÙŠØ± Ù…Ù†ÙØ°Ø© |

### ğŸ”µ P3 â€” Ù…Ù†Ø®ÙØ¶ / ØªØ­Ø³ÙŠÙ†Ø§Øª

| # | Ø§Ù„Ù…Ø´ÙƒÙ„Ø© | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ØªØ£Ø«ÙŠØ± |
|---|---------|-------|---------|
| 21 | **Mecca hardcoded** ÙƒÙ€ fallback ÙÙŠ LocationService | `location_service.dart` | Ù„ÙŠØ³ Ù…Ø«Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¨Ø¹ÙŠØ¯ÙŠÙ† |
| 22 | **Ù„Ø§ ÙŠÙˆØ¬Ø¯ unit tests** | `test/` | Ù„Ø§ Ø­Ù…Ø§ÙŠØ© Ù…Ù† regression |
| 23 | **Toast retry logic** Ù‡Ø´ â€” ÙŠØ¤Ø¬Ù„ Ø¥Ø·Ø§Ø±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ | `toast_service.dart` | Ù‚Ø¯ ÙŠÙØ´Ù„ ÙÙŠ screens Ù…Ø¹Ù‚Ø¯Ø© |
| 24 | **ØµÙ„ÙˆØ§Øª Ø§Ù„ÙØ¬Ø± Ù„Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ** â€” Ù‚Ø¯ ØªÙØ­Ø³Ø¨ Ø®Ø§Ø·Ø¦Ø© ÙÙŠ Ø±Ø¨Ø· streak | `firestore_service.dart` | streak ÙŠØ¨Ø¯Ùˆ Ù…ÙƒØ³ÙˆØ±Ø§Ù‹ |
| 25 | **Ù„Ø§ code generation** (freezed, json_serializable) â€” serialization ÙŠØ¯ÙˆÙŠ | ÙƒÙ„ models | Ø§Ø­ØªÙ…Ø§Ù„ Ø£Ø®Ø·Ø§Ø¡ ÙŠØ¯ÙˆÙŠØ© |

---

## 5. Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ÙˆØ§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

### Clean Architecture (Ø¨ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª)
```
Presentation (Screen/Widget/Controller)
    â†“ ÙŠØ³ØªØ¯Ø¹ÙŠ
Data (Repository/Service)
    â†“ ÙŠØ³ØªØ¯Ø¹ÙŠ
Core (Helpers/Constants/DI)
```
**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**: Ù„Ø§ ÙŠØ³ØªØ¯Ø¹ÙŠ Core Ø£ÙŠ Feature. Ù„Ø§ ÙŠØ³ØªØ¯Ø¹ÙŠ Data Ø·Ø¨Ù‚Ø© Presentation.

### Ù†Ù…Ø· Repository (Offline-First)
```dart
Future<bool> addPrayerLog(PrayerLogModel log) async {
  // 1. Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙˆØ±Ø§Ù‹ (optimistic update)
  await _db.insertPrayerLog(log);

  // 2. Ù…Ø­Ø§ÙˆÙ„Ø© Sync Ù„Ù„Ù€ Firestore
  if (_connectivity.isConnected) {
    try {
      await _firestore.addPrayerLog(log);
      return true; // synced
    } catch (e) {
      await _queueForSync(log); // queue for later
      return false;
    }
  } else {
    await _queueForSync(log);
    return false;
  }
}
```

### Ù†Ù…Ø· Controller (GetX)
```dart
class FeatureController extends GetxController {
  // âœ… Ø§Ù„Ù€ services ØªÙØ­Ù‚Ù† Ù…Ù† GetIt
  final _service = GetIt.I<FeatureService>();

  // âœ… ÙƒÙ„ state Ù…Ø±ØµÙˆØ¯
  final isLoading = false.obs;
  final data = Rxn<DataModel>();

  @override
  void onInit() {
    super.onInit();
    _loadData();
  }

  @override
  void onClose() {
    _subscription?.cancel();
    super.onClose();
  }
}
```

### Ù†Ù…Ø· Binding
```dart
class FeatureBinding extends Bindings {
  @override
  void dependencies() {
    // Controller ÙÙ‚Ø· â€” Services ÙÙŠ GetIt
    Get.lazyPut(() => FeatureController());
  }
}
```

### ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ DI (injection_container.dart)
```dart
// GetxService (ÙŠØ¹ÙŠØ´ Ø·ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)
sl.registerLazySingleton<MyService>(() => MyService(
  dep: sl<AnotherService>(),
));

// Ù„Ø§ ØªØ³Ø¬Ù„ Controllers Ù‡Ù†Ø§ â€” ÙÙŠ Binding ÙÙ‚Ø·
```

---

## 6. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

### UserModel (Ø£Ù‡Ù… model)
```
id, name, birthDate, gender, email, photoUrl, language
currentStreak, longestStreak, totalPrayers, lastPrayerAt
familyId, groupIds[], role, isParent
notificationsEnabled, [fajr/dhuhr/asr/maghrib/isha]NotifEnabled
reminderEnabled, familyNotificationsEnabled
calculationMethod (enum), madhab (shafi/hanafi)
latitude, longitude, cityName (nullable)
userPrivacySettings
prayerOffsets: Map<String, int>  â† Ù…Ø´ÙƒÙ„Ø©: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Map<PrayerName, int>
```

### PrayerLogModel
```
id, oderId (â† ØªØ§ÙŠØ¨Ùˆ! ÙŠØ¬Ø¨ userId), prayer (PrayerName enum)
prayedAt, adhanTime, quality (@Deprecated), timingQuality
addedByLeaderId, note
```

### GroupModel
```
groupId, name, type (family/guided/friends)
inviteCode, createdAt, createdBy, adminId
lastAdminActivity, blockedUserIds[], memberIds[], memberCount
```

---

## 7. Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª

| Ø§Ù„Ø®Ø¯Ù…Ø© | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© |
|--------|--------|-----------|
| `AuthService` | âœ… Ù…ÙƒØªÙ…Ù„ | Firebase Auth wrapper |
| `FirestoreService` | âœ… Ù…ÙƒØªÙ…Ù„ | Firestore CRUD |
| `StorageService` | âœ… Ù…ÙƒØªÙ…Ù„ | GetStorage wrapper |
| `DatabaseHelper` | âœ… Ù…ÙƒØªÙ…Ù„ | SQLite: prayer logs, sync queue |
| `ConnectivityService` | âš ï¸ Ø¬Ø²Ø¦ÙŠ | ÙØ­Øµ Ø´Ø¨ÙƒØ© (Ù„ÙŠØ³ Ø¥Ù†ØªØ±Ù†Øª ÙØ¹Ù„ÙŠ) |
| `LocationService` | âœ… Ù…ÙƒØªÙ…Ù„ | GPS + reverse geocoding |
| `PrayerTimeService` | âœ… Ù…ÙƒØªÙ…Ù„ | Aladhan API + cache + offsets |
| `AladhanApiService` | âœ… Ù…ÙƒØªÙ…Ù„ | HTTP client Ù„Ù„Ù€ Aladhan API |
| `LiveContextService` | âœ… Ù…ÙƒØªÙ…Ù„ | Current prayer + countdown |
| `NotificationService` | âœ… Ù…ÙƒØªÙ…Ù„ | Local notifications |
| `NotificationScheduler` | âœ… Ù…ÙƒØªÙ…Ù„ | Schedule adhan + reminders |
| `SmartNotificationService` | âœ… Ù…ÙƒØªÙ…Ù„ | Smart reminder logic |
| `PrayerLogger` | âœ… Ù…ÙƒØªÙ…Ù„ | Log prayer + quality calculation |
| `QadaDetectionService` | âœ… Ù…ÙƒØªÙ…Ù„ | Detect missed prayers |
| `SyncService` | âœ… Ù…ÙƒØªÙ…Ù„ | Sync queue management |
| `ThemeService` | âœ… Ù…ÙƒØªÙ…Ù„ | Light/dark theme |
| `LocalizationService` | âœ… Ù…ÙƒØªÙ…Ù„ | AR/EN switching |
| `CloudinaryService` | âœ… Ù…ÙƒØªÙ…Ù„ | Image upload |
| `FamilyService` | âŒ **Ù…ÙÙ‚ÙˆØ¯** | Group CRUD + pulse events |
| `FcmService` | âš ï¸ Ø¬Ø²Ø¦ÙŠ | FCM â€” Server key Ù…ÙÙ‚ÙˆØ¯ |

---

## 8. Ø§Ù„Ù€ Routes Ø§Ù„ÙƒØ§Ù…Ù„Ø©

```dart
/splash              â†’ SplashScreen (fade)
/onboarding          â†’ OnboardingScreen (4 ØµÙØ­Ø§Øª)
/login               â†’ LoginScreen
/register            â†’ RegisterScreen
/profile-setup       â†’ ProfileSetupScreen
/dashboard           â†’ MainShellScreen (middleware: OnboardingMiddleware)
  â”œâ”€â”€ tab 0: DashboardHomeContent (prayer times + logging)
  â””â”€â”€ tab 1: FamilyScreen (groups + pulse)
/family/create       â†’ CreateGroupScreen
/family/join         â†’ JoinGroupScreen
/settings            â†’ SettingsScreen
/settings/select-city â†’ SelectCityScreen
/settings/prayer-adjustment â†’ PrayerAdjustmentScreen
/settings/privacy    â†’ PrivacySettingsScreen
/profile             â†’ ProfileScreen
/missed-prayers      â†’ MissedPrayersScreen
/stats               â†’ StatsScreen
/qibla               â†’ QiblaScreen
```

---

## 9. Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø­Ø±Ø¬Ø© (P0) â€” Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ø·Ù„Ù‚Ø©

**1.1 â€” Ø¥ØµÙ„Ø§Ø­ ØªØ§ÙŠØ¨Ùˆ `oderId`**
```
Ø§Ù„Ù…Ù„ÙØ§Øª: prayer_log_model.dart, database_helper.dart, prayer_repository.dart, firestore_service.dart
Ø§Ù„Ø®Ø·ÙˆØ§Øª:
  1. Ø£Ø¶Ù getter userId ÙŠØ±Ø¬Ø¹ oderId (backward compat)
  2. ÙÙŠ SQLite: Ø£Ø¶Ù migration Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ userId
  3. ÙÙŠ fromFirestore: Ø§Ù‚Ø±Ø£ userId Ù…Ø¹ fallback Ù„Ù€ oderId
  4. ÙÙŠ toFirestore: Ø§ÙƒØªØ¨ userId (ÙˆÙ„ÙŠØ³ oderId)
  5. Ø£Ø¨Ù‚Ù oderId ÙÙŠ Ø§Ù„Ù€ write Ù„Ù„ØªÙˆØ§ÙÙ‚ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
```

**1.2 â€” Ø¥ØµÙ„Ø§Ø­ Stream Leaks**
```
Ø§Ù„Ù…Ù„ÙØ§Øª: dashboard_controller.dart, family_controller.dart
Ø§Ù„Ø¥ØµÙ„Ø§Ø­:
  StreamSubscription? _prayerSub;
  _prayerSub = stream.listen(handler);

  @override
  void onClose() {
    _prayerSub?.cancel();
    super.onClose();
  }
```

**1.3 â€” ØªÙØ¹ÙŠÙ„ FCM**
```
Ø§Ù„Ù…Ù„ÙØ§Øª: fcm_service.dart, family_controller.dart
Ø§Ù„Ø®Ø·ÙˆØ§Øª:
  1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Server Key Ù…Ù† Firebase Console
  2. ØªÙØ¹ÙŠÙ„ subscribeToFamily() Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
  3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Cloud Function (functions/index.js)
```

**1.4 â€” Ø¥ØµÙ„Ø§Ø­ Google Sign-In**
```
Ø§Ù„Ø®Ø·ÙˆØ§Øª:
  1. ØªØ´ØºÙŠÙ„ get_sha1.bat (Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹) Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA-1
  2. Ø¥Ø¶Ø§ÙØ© SHA-1 ÙÙŠ Firebase Console â†’ Project Settings â†’ Android App
  3. ØªØ­Ù…ÙŠÙ„ google-services.json Ø§Ù„Ø¬Ø¯ÙŠØ¯
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ø³ØªÙ‚Ø±Ø§Ø± (P1)

**2.1 â€” ÙØ­Øµ Ø¥Ù†ØªØ±Ù†Øª Ø­Ù‚ÙŠÙ‚ÙŠ**
```dart
// ÙÙŠ connectivity_service.dart
Future<bool> hasRealInternetAccess() async {
  try {
    final result = await http.get(
      Uri.parse('https://www.google.com'),
    ).timeout(Duration(seconds: 5));
    return result.statusCode == 200;
  } catch (_) {
    return false;
  }
}
```

**2.2 â€” ØªØ±Ø­ÙŠÙ„ PrayerQuality â†’ PrayerTimingQuality**
```
Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: PrayerQuality (Ù„ÙŠØ³ @Deprecated class Ù†ÙØ³Ù‡)
Ø§Ù„ØªØºÙŠÙŠØ±: Ø§Ø³ØªØ®Ø¯Ù… PrayerTimingQuality ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†
Ø§Ù„Ù…Ù„ÙØ§Øª: prayer_log_model.dart, prayer_logger.dart, missed_prayers UI
```

**2.3 â€” Ø¥ØµÙ„Ø§Ø­ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„**
```
Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ØŒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ¹Ø±Ø¶ ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± Ù„Ù„ØºØ¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙÙŠ: live_context_service.dart
  - Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª ÙƒÙ„ ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ø­Ø¶Ø± ÙØ¬Ø± Ø§Ù„ØºØ¯ ÙˆØ£Ø¹Ø±Ø¶Ù‡ ÙƒØ§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
```

**2.4 â€” ØªØµØ­ÙŠØ­ Onboarding**
```
Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ù€ controller ÙŠØ­ØªÙˆÙŠ ØµÙØ­Ø© Family (page 3) Ù„Ù… ØªØ¹Ø¯ ÙÙŠ Ø§Ù„Ù€ spec
Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙÙŠ: onboarding_controller.dart
  - Ø­Ø°Ù ØµÙØ­Ø© Family Ù…Ù† Ø§Ù„ØªØ¯ÙÙ‚
  - ØªØ¹Ø¯ÙŠÙ„ pageCount Ù…Ù† 5 Ø¥Ù„Ù‰ 4
```

**2.5 â€” Ø±Ø¨Ø· AppLogger Ø¨Ù€ Crashlytics**
```dart
// ÙÙŠ app_logger.dart - Ø§Ù„Ù€ TODO Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
static void _onRelease(String level, String message, Object? error) {
  FirebaseCrashlytics.instance.recordError(
    error ?? message,
    null,
    reason: '[$level] $message',
  );
}
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø¨Ù†Ø§Ø¡ Family Feature

**3.1 â€” Ø¥Ù†Ø´Ø§Ø¡ FamilyService**
```
Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª:
  - CRUD Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (createGroup, joinGroup, leaveGroup)
  - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (addMember, removeMember, promoteMember)
  - Pulse events (addPulseEvent, subscribeToPulse)
  - Family summary (aggregated prayer stats)
```

**3.2 â€” Ø±Ø¨Ø· FCM Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©**
```
Ø¹Ù†Ø¯ createGroup: subscribeToTopic('family_${groupId}')
Ø¹Ù†Ø¯ joinGroup: subscribeToTopic('family_${groupId}')
Ø¹Ù†Ø¯ leaveGroup: unsubscribeFromTopic('family_${groupId}')
```

**3.3 â€” Family Screen Ø§Ù„ÙƒØ§Ù…Ù„Ø©**
```
Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:
  â”œâ”€â”€ Header: Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© + Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
  â”œâ”€â”€ Summary Card: X/Y ØµÙ„Ù‘ÙˆØ§ Ø§Ù„ÙŠÙˆÙ… (privacy-first)
  â”œâ”€â”€ Pulse Feed: Ø¢Ø®Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (logged prayer, encouragement)
  â”œâ”€â”€ Member List: ÙƒÙ„ Ø¹Ø¶Ùˆ + streak + Ø­Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…
  â””â”€â”€ Actions: Ø¯Ø¹ÙˆØ© Ø¹Ø¶ÙˆØŒ Ø´Ø§Ø±Ùƒ Ø±Ø§Ø¨Ø·ØŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
```

**3.4 â€” Admin Succession**
```dart
// Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© admin
if (leavingUser.id == group.adminId) {
  final nextAdmin = members
    .where((m) => m.userId != leavingUser.id)
    .sortedBy((m) => m.joinedAt)
    .firstOrNull;
  if (nextAdmin != null) {
    await updateGroupAdmin(groupId, nextAdmin.userId);
  } else {
    await deleteGroup(groupId); // Ø¢Ø®Ø± Ø¹Ø¶Ùˆ ÙŠØºØ§Ø¯Ø±
  }
}
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø¬ÙˆØ¯Ø© ÙˆØµÙŠØ§Ù†Ø© (P2/P3)

**4.1 â€” ØªÙ†Ø¸ÙŠÙ Route Names**
```
// ÙÙŠ app_routes.dart â€” Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ±Ø±Ø§Øª
// createFamily == createGroup â†’ Ø§Ø­ØªÙØ¸ Ø¨Ù€ createGroup ÙÙ‚Ø·
// joinFamily == joinGroup â†’ Ø§Ø­ØªÙØ¸ Ø¨Ù€ joinGroup ÙÙ‚Ø·
```

**4.2 â€” Ø¥Ø¶Ø§ÙØ© Unit Tests**
```
Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª:
  - test/helpers/prayer_timing_helper_test.dart
  - test/helpers/date_time_helper_test.dart
  - test/helpers/input_validators_test.dart
  - test/repositories/prayer_repository_test.dart (mocked)
```

**4.3 â€” ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£**
```dart
// ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
if (e is SocketException) return 'no_internet'.tr;
if (e is TimeoutException) return 'request_timeout'.tr;
if (e is FirebaseException) return 'server_error'.tr;
return 'unexpected_error'.tr;
```

---

## 10. Ù…Ø±Ø¬Ø¹ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©

| Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù€ | Ø§Ù„Ù…Ù„Ù |
|--------------|-------|
| Ø¥Ø¶Ø§ÙØ© route Ø¬Ø¯ÙŠØ¯ | `core/routes/app_routes.dart` + `app_pages.dart` |
| Ø¥Ø¶Ø§ÙØ© string Ù„Ù„ØªØ±Ø¬Ù…Ø© | `core/localization/ar_translations.dart` + `en_translations.dart` |
| Ø¥Ø¶Ø§ÙØ© service Ø¬Ø¯ÙŠØ¯ | `core/di/injection_container.dart` |
| Ø¥Ø¶Ø§ÙØ© storage key | `core/constants/storage_keys.dart` |
| Ø¥Ø¶Ø§ÙØ© Firestore collection | `core/constants/api_constants.dart` |
| Ø¹Ø±Ø¶ toast/error | `AppFeedback.show*()` |
| ØªØ³Ø¬ÙŠÙ„ Ø®Ø·Ø£ | `AppLogger.error()` |
| Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© | `features/prayer/data/services/prayer_time_service.dart` |
| ØªØ³Ø¬ÙŠÙ„ ØµÙ„Ø§Ø© | `features/prayer/data/services/prayer_logger.dart` |
| Ù‚Ø±Ø§Ø¡Ø©/ÙƒØªØ§Ø¨Ø© Firestore | `features/prayer/data/services/firestore_service.dart` |
| Ù‚Ø±Ø§Ø¡Ø©/ÙƒØªØ§Ø¨Ø© SQLite | `core/services/database_helper.dart` |
| Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | `features/auth/data/models/user_model.dart` |

---

## 11. Ù‡ÙŠÙƒÙ„ Firestore

```
users/{userId}
  prayer_logs/{logId}
  notifications/{notifId}
  achievements/{achievementId}

groups/{groupId}
  members (subcollection)

families/{familyId}
  pulse/{pulseId}  â† ØªÙØ·Ù„Ù‚ Cloud Function â†’ FCM

achievements/{achievementId}  (read-only reference)
analytics/{analyticsId}
reactions/{reactionId}
```

---

## 12. Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

1. **Ø§Ø¨Ø¯Ø£ Ø¯Ø§Ø¦Ù…Ø§Ù‹** Ø¨Ù‚Ø±Ø§Ø¡Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù‚Ø¨Ù„ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„
2. **ØªØ­Ù‚Ù‚ Ù…Ù† docs/** Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªÙ†Ø¯ Ø®Ø§Øµ Ø¨Ø§Ù„Ù…ÙŠØ²Ø© (`SYNC.md`, `FAMILY_GROUPS_SPEC.md`, Ø¥Ù„Ø®)
3. **Ù„Ø§ ØªÙƒØ³Ø± Ø§Ù„Ù€ offline-first pattern** â€” Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹
4. **Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØªØ­Ø¯Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©** â€” ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ UI ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ø¨Ø± `.tr`
5. **Ø§Ù„ÙØ±Ø¹ `feature/many`** Ù‡Ùˆ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ·ÙˆÙŠØ±
6. **Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ beta** â€” Ù†Ø³Ø®Ø© `1.0.0+1`

---

*Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠÙØ­Ø¯ÙÙ‘Ø« Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„ Ù…Ù‡Ù…Ø©.*